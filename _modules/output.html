

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>output &mdash; T2GEORES  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> T2GEORES
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../modules/gener.html">gener</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/geometry.html">geometry</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/it2Obs.html">it2Obs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/model_plots.html">model_plots</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/output.html">output</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/regeo_mesh.html">regeo_mesh</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/run.html">run</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/t2geores_functions.html">t2geores_functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/txt2sqlite.html">txt2sqlite</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/writer.html">writer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/formats.html">formats</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/report.html">report</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">T2GEORES</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Module code</a> &raquo;</li>
        
      <li>output</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for output</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">csv</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">sqlite3</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">It extracts the blocks information containing on a TOUGH2 output file.</span>
<span class="sd">&quot;&quot;&quot;</span>

<div class="viewcode-block" id="write_PT_from_t2output"><a class="viewcode-back" href="../modules/output.html#output.write_PT_from_t2output">[docs]</a><span class="k">def</span> <span class="nf">write_PT_from_t2output</span><span class="p">(</span><span class="n">input_dictionary</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;It writes the parameter for every block from every well from the last output file of TOUGH2 simulation</span>

<span class="sd">	Parameters</span>
<span class="sd">	----------</span>
<span class="sd">	input_dictionary : dictionary</span>
<span class="sd">	 Dictionary contaning the path and name of database on keyword &#39;db_path&#39;, list of wells under the keywords &#39;WELLS&#39;, &#39;MAKE_UP_WELLS&#39; and &#39;NOT_PRODUCING_WELL&#39;</span>

<span class="sd">	Returns</span>
<span class="sd">	-------</span>
<span class="sd">	file</span>
<span class="sd">	  {well_name}_PT.txt: file containing the information for every block from every well</span>

<span class="sd">	Attention</span>
<span class="sd">	---------</span>
<span class="sd">	The layers and well block need  to be on the databse</span>

<span class="sd">	Examples</span>
<span class="sd">	--------</span>
<span class="sd">	&gt;&gt;&gt; write_PT_from_t2output(input_dictionary)</span>
<span class="sd">	&quot;&quot;&quot;</span>

	<span class="n">wells</span><span class="o">=</span><span class="p">[]</span>

	<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;WELLS&#39;</span><span class="p">,</span><span class="s1">&#39;MAKE_UP_WELLS&#39;</span><span class="p">,</span><span class="s1">&#39;NOT_PRODUCING_WELL&#39;</span><span class="p">]:</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="k">for</span> <span class="n">well</span> <span class="ow">in</span> <span class="n">input_dictionary</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
				<span class="n">wells</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">well</span><span class="p">)</span>
		<span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
			<span class="k">pass</span>

	<span class="n">db_path</span><span class="o">=</span><span class="n">input_dictionary</span><span class="p">[</span><span class="s1">&#39;db_path&#39;</span><span class="p">]</span>

	<span class="n">t2_output_file</span><span class="o">=</span><span class="s2">&quot;../model/t2/t2.out&quot;</span>
	<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">t2_output_file</span><span class="p">):</span>
		<span class="k">pass</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="k">return</span> <span class="s2">&quot;Theres is not t2.out file on t2/t2.out&quot;</span>

	<span class="c1">#Extracts all the times the line &#39;OUTPUT DATA AFTER&#39; was printed</span>
	<span class="n">output_headers</span><span class="o">=</span><span class="p">[]</span>
	<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">t2_output_file</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">t2_file</span><span class="p">:</span>
		<span class="n">t2_output_array</span> <span class="o">=</span> <span class="n">t2_file</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
		<span class="k">for</span> <span class="n">line_i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">t2_output_array</span><span class="p">):</span>
			<span class="k">if</span> <span class="s2">&quot;OUTPUT DATA AFTER&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">():</span>
				<span class="n">output_headers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line_i</span><span class="p">)</span>

	<span class="n">conn</span><span class="o">=</span><span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">db_path</span><span class="p">)</span>
	<span class="n">c</span><span class="o">=</span><span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

	<span class="c1">#Create a dictionary containing all the blocks in a well</span>

	<span class="n">blocks_wells</span><span class="o">=</span><span class="p">{}</span>
	<span class="n">wells_data</span><span class="o">=</span><span class="p">{}</span>

	<span class="n">data_layer</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s2">&quot;SELECT correlative FROM layers ORDER BY  middle DESC;&quot;</span><span class="p">,</span><span class="n">conn</span><span class="p">)</span>
	<span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">wells</span><span class="p">):</span>
		<span class="n">wells_data</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
		<span class="n">data_block</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s2">&quot;SELECT blockcorr FROM t2wellblock  WHERE well=&#39;</span><span class="si">%s</span><span class="s2">&#39; ORDER BY blockcorr;&quot;</span><span class="o">%</span><span class="n">name</span><span class="p">,</span><span class="n">conn</span><span class="p">)</span>
		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_block</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
			<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">data_layer</span><span class="p">[</span><span class="s1">&#39;correlative&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
				<span class="n">blocks_wells</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="n">data_block</span><span class="p">[</span><span class="s1">&#39;blockcorr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">=</span><span class="n">name</span>
	
	<span class="c1">#Select the last line of TOUGH2 output file</span>
	<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">t2_output_array</span><span class="p">[</span><span class="n">output_headers</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
		<span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">blocks_wells</span><span class="p">:</span>
			<span class="k">if</span>  <span class="n">block</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">())</span><span class="o">==</span><span class="mi">11</span><span class="p">:</span>
				<span class="n">wells_data</span><span class="p">[</span><span class="n">blocks_wells</span><span class="p">[</span><span class="n">block</span><span class="p">]]</span><span class="o">+=</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()))</span>

	<span class="c1">#Writes an output file for every well</span>
	<span class="k">for</span> <span class="n">well</span> <span class="ow">in</span> <span class="n">wells_data</span><span class="p">:</span>
		<span class="n">file_out</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="s2">&quot;../output/PT/txt/</span><span class="si">%s</span><span class="s2">_PT.dat&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">well</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
		<span class="n">file_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;ELEM,INDEX,P,T,SG,SW,X(WAT1),X(WAT2),PCAP,DG,DW</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
		<span class="n">file_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">wells_data</span><span class="p">[</span><span class="n">well</span><span class="p">])</span>
		<span class="n">file_out</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

	<span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>
	
<div class="viewcode-block" id="from_sav_to_json"><a class="viewcode-back" href="../modules/output.html#output.from_sav_to_json">[docs]</a><span class="k">def</span> <span class="nf">from_sav_to_json</span><span class="p">(</span><span class="n">sav_version</span><span class="o">=</span><span class="s1">&#39;sav1&#39;</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;It writes a json file with temperature and pressure data from the specified .sav for every block including coordinates</span>
<span class="sd">	</span>
<span class="sd">	Parameters</span>
<span class="sd">	----------</span>
<span class="sd">	sav_version : str</span>
<span class="sd">	  Extension of sav file, i.e. sav, sav1, sav2, etc.</span>

<span class="sd">	Returns</span>
<span class="sd">	-------</span>
<span class="sd">	file</span>
<span class="sd">	  PT_json_from_sav.txt : on  ../output/PT/json/</span>

<span class="sd">	Attention</span>
<span class="sd">	---------</span>
<span class="sd">	The ELEME.json file needs to be updated</span>

<span class="sd">	Examples</span>
<span class="sd">	--------</span>
<span class="sd">	&gt;&gt;&gt; from_sav_to_json(sav_version=&#39;sav1&#39;)</span>
<span class="sd">	&quot;&quot;&quot;</span>

	<span class="n">output_sav_file</span><span class="o">=</span><span class="s2">&quot;../model/t2/t2.</span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">sav_version</span>

	<span class="c1">#Generates a dictionary with block as keyword and x,y,z coordinates</span>
	<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;../mesh/ELEME.json&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
	  	<span class="n">blocks_position</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

	<span class="n">eleme_dict</span><span class="o">=</span><span class="p">{}</span>
	<span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">blocks_position</span><span class="p">:</span>
		<span class="n">eleme_dict</span><span class="p">[</span><span class="n">block</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="n">blocks_position</span><span class="p">[</span><span class="n">block</span><span class="p">][</span><span class="s1">&#39;X&#39;</span><span class="p">],</span><span class="n">blocks_position</span><span class="p">[</span><span class="n">block</span><span class="p">][</span><span class="s1">&#39;Y&#39;</span><span class="p">],</span><span class="n">blocks_position</span><span class="p">[</span><span class="n">block</span><span class="p">][</span><span class="s1">&#39;Z&#39;</span><span class="p">]]</span>

	<span class="c1">#Creates a string from .sav file</span>
	<span class="n">savfile</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">output_sav_file</span><span class="p">,</span><span class="s2">&quot;r&quot;</span><span class="p">)</span>
	<span class="n">savstring</span><span class="o">=</span><span class="p">[]</span>
	<span class="k">for</span> <span class="n">linesav</span> <span class="ow">in</span> <span class="n">savfile</span><span class="p">:</span>
		<span class="n">savstring</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">linesav</span><span class="o">.</span><span class="n">rstrip</span><span class="p">())</span>
	<span class="n">savfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

	<span class="c1">#Stores Pressure and Temperature on the dictionary</span>
	<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">output_sav_file</span><span class="p">):</span>
		<span class="n">t2_sav_file</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">output_sav_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
		<span class="n">contidion_found</span><span class="o">=</span><span class="kc">False</span>
		<span class="k">for</span> <span class="n">t2_sav_line</span> <span class="ow">in</span> <span class="n">t2_sav_file</span><span class="p">:</span>
			<span class="k">if</span>  <span class="n">t2_sav_line</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span> <span class="ow">in</span>  <span class="n">eleme_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
				<span class="n">contidion_found</span><span class="o">=</span><span class="kc">True</span>
				<span class="n">block</span><span class="o">=</span><span class="n">t2_sav_line</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span>
				<span class="k">continue</span>
			<span class="k">if</span> <span class="n">contidion_found</span><span class="p">:</span>
				<span class="n">eleme_dict</span><span class="p">[</span><span class="n">block</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">t2_sav_line</span><span class="o">.</span><span class="n">split</span><span class="p">()])</span>
				<span class="n">contidion_found</span><span class="o">=</span><span class="kc">False</span>
		<span class="n">t2_sav_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

	<span class="n">eleme_pd</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">eleme_dict</span><span class="p">,</span><span class="n">orient</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">,</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span><span class="s1">&#39;P&#39;</span><span class="p">,</span><span class="s1">&#39;T&#39;</span><span class="p">])</span>
	<span class="n">eleme_pd</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="s2">&quot;../output/PT/json/PT_json_from_sav.txt&quot;</span><span class="p">,</span><span class="n">orient</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">,</span><span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span></div>

<div class="viewcode-block" id="PTjson_to_sqlite"><a class="viewcode-back" href="../modules/output.html#output.PTjson_to_sqlite">[docs]</a><span class="k">def</span> <span class="nf">PTjson_to_sqlite</span><span class="p">(</span><span class="n">input_dictionary</span><span class="p">,</span><span class="n">source</span><span class="o">=</span><span class="s1">&#39;t2&#39;</span><span class="p">,):</span>
	<span class="sd">&quot;&quot;&quot;It stores the defined json file into the database on the table t2PTout</span>
<span class="sd">	</span>
<span class="sd">	Parameters</span>
<span class="sd">	----------</span>
<span class="sd">	source : str</span>
<span class="sd">	  It can be &#39;t2&#39; or &#39;sav&#39;</span>
<span class="sd">	input_dictionary : dictionary</span>
<span class="sd">	 Dictionary contaning the path and name of database on keyword &#39;db_path&#39;.</span>

<span class="sd">	Examples</span>
<span class="sd">	--------</span>
<span class="sd">	&gt;&gt;&gt; PTjson_to_sqlite(&quot;t2&quot;)</span>
<span class="sd">	&quot;&quot;&quot;</span>

	<span class="n">db_path</span><span class="o">=</span><span class="n">input_dictionary</span><span class="p">[</span><span class="s1">&#39;db_path&#39;</span><span class="p">]</span>

	<span class="n">conn</span><span class="o">=</span><span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">db_path</span><span class="p">)</span>
	<span class="n">c</span><span class="o">=</span><span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
	<span class="k">if</span> <span class="n">source</span><span class="o">==</span><span class="s2">&quot;t2&quot;</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="s2">&quot;../output/PT/json/PT_json.txt&quot;</span><span class="p">):</span>
			<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;../output/PT/json/PT_json.txt&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
				<span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
			<span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
				<span class="k">try</span><span class="p">:</span>
					<span class="n">q</span><span class="o">=</span><span class="s2">&quot;INSERT INTO t2PTout(blockcorr,x,y,z,&#39;index&#39;,P,T,SG,SW,X1,X2,PCAP,DG,DW) </span><span class="se">\</span>
<span class="s2">					VALUES (&#39;</span><span class="si">%s</span><span class="s2">&#39;,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">)&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">element</span><span class="p">,</span>	<span class="n">data</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="s1">&#39;X&#39;</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="s1">&#39;Y&#39;</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="s1">&#39;Z&#39;</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="s1">&#39;INDEX&#39;</span><span class="p">],</span>\
																			<span class="n">data</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="s1">&#39;P&#39;</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="s1">&#39;T&#39;</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="s1">&#39;SG&#39;</span><span class="p">],</span>\
																			<span class="n">data</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="s1">&#39;SW&#39;</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="s1">&#39;X(WAT1)&#39;</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="s1">&#39;X(WAT2)&#39;</span><span class="p">],</span>\
																			<span class="n">data</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="s1">&#39;PCAP&#39;</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="s1">&#39;DG&#39;</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="s1">&#39;DW&#39;</span><span class="p">])</span>

					<span class="n">c</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
				<span class="k">except</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">IntegrityError</span><span class="p">:</span>
					<span class="n">q</span><span class="o">=</span><span class="s2">&quot;UPDATE t2PTout SET </span><span class="se">\</span>
<span class="s2">					x=</span><span class="si">%s</span><span class="s2">, </span><span class="se">\</span>
<span class="s2">					y=</span><span class="si">%s</span><span class="s2">, </span><span class="se">\</span>
<span class="s2">					z=</span><span class="si">%s</span><span class="s2">, </span><span class="se">\</span>
<span class="s2">					&#39;index&#39;=</span><span class="si">%s</span><span class="s2">, </span><span class="se">\</span>
<span class="s2">					P=</span><span class="si">%s</span><span class="s2">, </span><span class="se">\</span>
<span class="s2">					T=</span><span class="si">%s</span><span class="s2">, </span><span class="se">\</span>
<span class="s2">					SG=</span><span class="si">%s</span><span class="s2">, </span><span class="se">\</span>
<span class="s2">					SW=</span><span class="si">%s</span><span class="s2">, </span><span class="se">\</span>
<span class="s2">					X1=</span><span class="si">%s</span><span class="s2">, </span><span class="se">\</span>
<span class="s2">					X2=</span><span class="si">%s</span><span class="s2">, </span><span class="se">\</span>
<span class="s2">					PCAP=</span><span class="si">%s</span><span class="s2">, </span><span class="se">\</span>
<span class="s2">					DG=</span><span class="si">%s</span><span class="s2">, </span><span class="se">\</span>
<span class="s2">					DW=</span><span class="si">%s</span><span class="s2"> </span><span class="se">\</span>
<span class="s2">					WHERE blockcorr=&#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span><span class="o">%</span><span class="p">(</span>	<span class="n">data</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="s1">&#39;X&#39;</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="s1">&#39;Y&#39;</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="s1">&#39;Z&#39;</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="s1">&#39;INDEX&#39;</span><span class="p">],</span>\
											<span class="n">data</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="s1">&#39;P&#39;</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="s1">&#39;T&#39;</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="s1">&#39;SG&#39;</span><span class="p">],</span>\
											<span class="n">data</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="s1">&#39;SW&#39;</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="s1">&#39;X(WAT1)&#39;</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="s1">&#39;X(WAT2)&#39;</span><span class="p">],</span>\
											<span class="n">data</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="s1">&#39;PCAP&#39;</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="s1">&#39;DG&#39;</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="s1">&#39;DW&#39;</span><span class="p">],</span><span class="n">element</span><span class="p">)</span>
					<span class="n">c</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
				<span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
	<span class="k">elif</span> <span class="n">source</span><span class="o">==</span><span class="s2">&quot;sav&quot;</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="s2">&quot;../output/PT/json/PT_json_from_sav.txt&quot;</span><span class="p">):</span>
			<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;../output/PT/json/PT_json_from_sav.txt&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
				<span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
			<span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
				<span class="k">try</span><span class="p">:</span>
					<span class="n">q</span><span class="o">=</span><span class="s2">&quot;INSERT INTO t2PTout(blockcorr,x,y,z,P,T) </span><span class="se">\</span>
<span class="s2">					VALUES (&#39;</span><span class="si">%s</span><span class="s2">&#39;,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">)&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">element</span><span class="p">,</span>\
												   <span class="n">data</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="s1">&#39;X&#39;</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="s1">&#39;Y&#39;</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="s1">&#39;Z&#39;</span><span class="p">],</span>\
												   <span class="n">data</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="s1">&#39;P&#39;</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="s1">&#39;T&#39;</span><span class="p">])</span>
					<span class="n">c</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
				<span class="k">except</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">IntegrityError</span><span class="p">:</span>
					<span class="n">q</span><span class="o">=</span><span class="s2">&quot;UPDATE t2PTout SET </span><span class="se">\</span>
<span class="s2">					x=</span><span class="si">%s</span><span class="s2">, </span><span class="se">\</span>
<span class="s2">					y=</span><span class="si">%s</span><span class="s2">, </span><span class="se">\</span>
<span class="s2">					z=</span><span class="si">%s</span><span class="s2">, </span><span class="se">\</span>
<span class="s2">					P=</span><span class="si">%s</span><span class="s2">, </span><span class="se">\</span>
<span class="s2">					T=</span><span class="si">%s</span><span class="s2"> </span><span class="se">\</span>
<span class="s2">					WHERE blockcorr=&#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="s1">&#39;ELEM&#39;</span><span class="p">],</span>\
										   <span class="n">data</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="s1">&#39;X&#39;</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="s1">&#39;Y&#39;</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="s1">&#39;Z&#39;</span><span class="p">],</span>\
										   <span class="n">data</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="s1">&#39;P&#39;</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="s1">&#39;T&#39;</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="s1">&#39;ELEM&#39;</span><span class="p">])</span>
					<span class="n">c</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
				<span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

	<span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

<div class="viewcode-block" id="write_PT_of_wells_from_t2output_in_time"><a class="viewcode-back" href="../modules/output.html#output.write_PT_of_wells_from_t2output_in_time">[docs]</a><span class="k">def</span> <span class="nf">write_PT_of_wells_from_t2output_in_time</span><span class="p">(</span><span class="n">input_dictionary</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;It generates file containing the evolution of every block on every well</span>

<span class="sd">	Extrae la evolucion de los bloques relacionados de todos los pozos en la direccion &quot;../output/PT/evol&quot;</span>
<span class="sd">	</span>
<span class="sd">	Parameters</span>
<span class="sd">	----------</span>
<span class="sd">	input_dictionary : dictionary</span>
<span class="sd">	  Dictionary contaning the path and name of database on keyword &#39;db_path&#39;, list of wells under the keywords &#39;WELLS&#39;, &#39;MAKE_UP_WELLS&#39; and &#39;NOT_PRODUCING_WELL&#39;</span>

<span class="sd">	Returns</span>
<span class="sd">	-------</span>
<span class="sd">	file</span>
<span class="sd">	  {well}_PT_{layer}.txt : on  ../output/PT/evol</span>

<span class="sd">	Examples</span>
<span class="sd">	--------</span>
<span class="sd">	&gt;&gt;&gt; write_PT_of_wells_from_t2output_in_time(input_dictionary)</span>
<span class="sd">	&quot;&quot;&quot;</span>

	<span class="n">db_path</span><span class="o">=</span><span class="n">input_dictionary</span><span class="p">[</span><span class="s1">&#39;db_path&#39;</span><span class="p">]</span>

	<span class="n">wells</span><span class="o">=</span><span class="p">[]</span>

	<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;WELLS&#39;</span><span class="p">,</span><span class="s1">&#39;MAKE_UP_WELLS&#39;</span><span class="p">,</span><span class="s1">&#39;NOT_PRODUCING_WELL&#39;</span><span class="p">]:</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="k">for</span> <span class="n">well</span> <span class="ow">in</span> <span class="n">input_dictionary</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
				<span class="n">wells</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">well</span><span class="p">)</span>
		<span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
			<span class="k">pass</span>

	<span class="n">conn</span><span class="o">=</span><span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">db_path</span><span class="p">)</span>
	<span class="n">c</span><span class="o">=</span><span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

	<span class="n">blocks_wells</span><span class="o">=</span><span class="p">{}</span>
	<span class="n">blocks_data</span><span class="o">=</span><span class="p">{}</span>

	<span class="c1">#Generates a dictionary with the blocks on a well as a keyword </span>
	<span class="n">data_layer</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s2">&quot;SELECT correlative FROM layers ORDER BY  middle DESC;&quot;</span><span class="p">,</span><span class="n">conn</span><span class="p">)</span>
	<span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">wells</span><span class="p">):</span>
		<span class="n">data_block</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s2">&quot;SELECT blockcorr FROM t2wellblock  WHERE well=&#39;</span><span class="si">%s</span><span class="s2">&#39; ORDER BY blockcorr;&quot;</span><span class="o">%</span><span class="n">name</span><span class="p">,</span><span class="n">conn</span><span class="p">)</span>
		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_block</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
			<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">data_layer</span><span class="p">[</span><span class="s1">&#39;correlative&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
				<span class="n">blocks_wells</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="n">data_block</span><span class="p">[</span><span class="s1">&#39;blockcorr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">=</span><span class="n">name</span>
				<span class="n">blocks_data</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="n">data_block</span><span class="p">[</span><span class="s1">&#39;blockcorr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">=</span><span class="s2">&quot;&quot;</span>

	<span class="c1">#Explore the TOUGH2 output file line by line and store the information if the block list generated on the previous step is on the line.</span>
	<span class="n">output_t2_file</span><span class="o">=</span><span class="s2">&quot;../model/t2/t2.out&quot;</span>
	<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">output_t2_file</span><span class="p">):</span>
		<span class="n">t2_file</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">output_t2_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">t2_line</span> <span class="ow">in</span> <span class="n">t2_file</span><span class="p">:</span>
			<span class="k">if</span> <span class="s2">&quot;OUTPUT DATA AFTER&quot;</span> <span class="ow">in</span> <span class="n">t2_line</span><span class="p">:</span>
				<span class="n">time</span><span class="o">=</span><span class="n">t2_line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
			<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">t2_line</span><span class="o">.</span><span class="n">split</span><span class="p">())</span><span class="o">==</span><span class="mi">11</span> <span class="ow">and</span> <span class="n">t2_line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">blocks_data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
				<span class="n">t2_array</span><span class="o">=</span><span class="n">t2_line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
				<span class="n">data_list</span><span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">t2_array</span><span class="p">))</span>
				<span class="n">data_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
				<span class="n">blocks_data</span><span class="p">[</span><span class="n">t2_line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]]</span><span class="o">+=</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_list</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
		<span class="n">t2_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;The file </span><span class="si">%s</span><span class="s2"> or directory do not exist&quot;</span><span class="o">%</span><span class="n">output_t2_file</span><span class="p">)</span>

	<span class="c1">#Store the data from the dictionary in files</span>
	<span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">blocks_data</span><span class="p">:</span>
		<span class="n">evol_file_out</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="s2">&quot;../output/PT/evol/</span><span class="si">%s</span><span class="s2">_PT_</span><span class="si">%s</span><span class="s2">_evol.dat&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">blocks_wells</span><span class="p">[</span><span class="n">block</span><span class="p">],</span><span class="n">block</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
		<span class="n">evol_file_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;ELEM,INDEX,P,T,SG,SW,X(WAT1),X(WAT2),PCAP,DG,DW,TIME</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
		<span class="n">evol_file_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">blocks_data</span><span class="p">[</span><span class="n">block</span><span class="p">])</span>
		<span class="n">evol_file_out</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>	
	<span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

<div class="viewcode-block" id="gen_evol"><a class="viewcode-back" href="../modules/output.html#output.gen_evol">[docs]</a><span class="k">def</span> <span class="nf">gen_evol</span><span class="p">(</span><span class="n">input_dictionary</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;It generates an output file containing flow and flowing enthalpy for each GEN element. As a convention the library it is suggested to use GEN for any source/sink that is not a well</span>

<span class="sd">	Parameters</span>
<span class="sd">	----------</span>
<span class="sd">	input_dictionary : dictionary</span>
<span class="sd">	 Dictionary contaning the path and name of database on keyword &#39;db_path&#39;.</span>

<span class="sd">	Returns</span>
<span class="sd">	-------</span>
<span class="sd">	file</span>
<span class="sd">	  {GEN}_{BLOCK}_{NICKNAME}.txt : on  ../output/mh/txt</span>

<span class="sd">	&quot;&quot;&quot;</span>

	<span class="n">db_path</span><span class="o">=</span><span class="n">input_dictionary</span><span class="p">[</span><span class="s1">&#39;db_path&#39;</span><span class="p">]</span>

	<span class="c1">#List the GEN elements</span>
	<span class="n">conn</span><span class="o">=</span><span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">db_path</span><span class="p">)</span>
	<span class="n">c</span><span class="o">=</span><span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
	<span class="n">data_source</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s2">&quot;SELECT well,blockcorr,source_nickname FROM t2wellsource WHERE  source_nickname LIKE&#39;GEN*&#39; ORDER BY source_nickname;&quot;</span><span class="p">,</span><span class="n">conn</span><span class="p">)</span>

	<span class="n">final_t2</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
	<span class="n">output_fi_file</span><span class="o">=</span><span class="s2">&quot;../model/t2/t2.out&quot;</span>

	<span class="c1">#Initialize a dictionary containing the file path and name.</span>
	<span class="n">dictionary_files</span><span class="o">=</span><span class="p">{}</span>
	<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data_source</span><span class="p">)):</span>
		<span class="n">well</span><span class="o">=</span><span class="n">data_source</span><span class="p">[</span><span class="s1">&#39;well&#39;</span><span class="p">][</span><span class="n">n</span><span class="p">]</span>
		<span class="n">blockcorr</span><span class="o">=</span><span class="n">data_source</span><span class="p">[</span><span class="s1">&#39;blockcorr&#39;</span><span class="p">][</span><span class="n">n</span><span class="p">]</span>
		<span class="n">source</span><span class="o">=</span><span class="n">data_source</span><span class="p">[</span><span class="s1">&#39;source_nickname&#39;</span><span class="p">][</span><span class="n">n</span><span class="p">]</span>
		<span class="n">dictionary_files</span><span class="p">[</span><span class="n">well</span><span class="p">]</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;filename&#39;</span><span class="p">:</span><span class="s2">&quot;../output/mh/txt/</span><span class="si">%s</span><span class="s2">_</span><span class="si">%s</span><span class="s2">_</span><span class="si">%s</span><span class="s2">_evol_mh.dat&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">well</span><span class="p">,</span><span class="n">blockcorr</span><span class="p">,</span><span class="n">source</span><span class="p">),</span><span class="s1">&#39;file_container&#39;</span><span class="p">:</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s1">&#39;blockcorr&#39;</span><span class="p">:</span><span class="n">blockcorr</span><span class="p">,</span><span class="s1">&#39;source&#39;</span><span class="p">:</span><span class="n">source</span><span class="p">}</span>
		<span class="n">dictionary_files</span><span class="p">[</span><span class="n">well</span><span class="p">][</span><span class="s1">&#39;file_container&#39;</span><span class="p">]</span><span class="o">+=</span><span class="s2">&quot;ELEMENT,SOURCEINDEX,GENERATION RATE,ENTHALPY,X1,X2,FF(GAS),FF(AQ.),P(WB),TIME</span><span class="se">\n</span><span class="s2">&quot;</span>

	<span class="c1">#It reads the TOUGH2 output file line by line and store the data from each GEN element</span>
	<span class="n">output_t2_file</span><span class="o">=</span><span class="s2">&quot;../model/t2/t2.out&quot;</span>
	<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">output_t2_file</span><span class="p">):</span>
		<span class="n">t2_file</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">output_t2_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">t2_line</span> <span class="ow">in</span> <span class="n">t2_file</span><span class="p">:</span>
			<span class="k">if</span> <span class="s2">&quot;OUTPUT DATA AFTER&quot;</span> <span class="ow">in</span> <span class="n">t2_line</span><span class="p">:</span>
				<span class="n">time</span><span class="o">=</span><span class="n">t2_line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
			<span class="k">for</span> <span class="n">well</span> <span class="ow">in</span> <span class="n">dictionary_files</span><span class="p">:</span>
				<span class="k">if</span> <span class="n">dictionary_files</span><span class="p">[</span><span class="n">well</span><span class="p">][</span><span class="s1">&#39;blockcorr&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">t2_line</span> <span class="ow">and</span> <span class="n">dictionary_files</span><span class="p">[</span><span class="n">well</span><span class="p">][</span><span class="s1">&#39;source&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">t2_line</span><span class="p">:</span>
					<span class="n">t2_array</span><span class="o">=</span><span class="n">t2_line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
					<span class="n">str_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">t2_array</span><span class="p">))</span>
					<span class="n">str_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
					<span class="n">dictionary_files</span><span class="p">[</span><span class="n">well</span><span class="p">][</span><span class="s1">&#39;file_container&#39;</span><span class="p">]</span><span class="o">+=</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">str_list</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
		<span class="n">t2_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;The file </span><span class="si">%s</span><span class="s2"> or directory do not exist&quot;</span><span class="o">%</span><span class="n">output_t2_file</span><span class="p">)</span>

	<span class="c1">#Creates a file for every GEN elemen</span>
	<span class="k">for</span> <span class="n">well</span> <span class="ow">in</span> <span class="n">dictionary_files</span><span class="p">:</span>
		<span class="n">t2_file_out</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">dictionary_files</span><span class="p">[</span><span class="n">well</span><span class="p">][</span><span class="s1">&#39;filename&#39;</span><span class="p">],</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
		<span class="n">t2_file_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">dictionary_files</span><span class="p">[</span><span class="n">well</span><span class="p">][</span><span class="s1">&#39;file_container&#39;</span><span class="p">])</span>
		<span class="n">t2_file_out</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>	

	<span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

<div class="viewcode-block" id="src_evol"><a class="viewcode-back" href="../modules/output.html#output.src_evol">[docs]</a><span class="k">def</span> <span class="nf">src_evol</span><span class="p">(</span><span class="n">input_dictionary</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;It generates an output file containing flow and flowing enthalpy for each SRC element. As a convention the library it is suggested to use SRC for any source/sink that is a well</span>

<span class="sd">	Parameters</span>
<span class="sd">	----------</span>
<span class="sd">	input_dictionary : dictionary</span>
<span class="sd">	 Dictionary contaning the path and name of database on keyword &#39;db_path&#39;.</span>

<span class="sd">	Returns</span>
<span class="sd">	-------</span>
<span class="sd">	file</span>
<span class="sd">	  {GEN}_{BLOCK}_{NICKNAME}.txt : on  ../output/mh/txt</span>

<span class="sd">	&quot;&quot;&quot;</span>

	<span class="c1">#See comment for gen_evol</span>

	<span class="n">db_path</span><span class="o">=</span><span class="n">input_dictionary</span><span class="p">[</span><span class="s1">&#39;db_path&#39;</span><span class="p">]</span>

	<span class="n">conn</span><span class="o">=</span><span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">input_data</span><span class="p">[</span><span class="s1">&#39;db_path&#39;</span><span class="p">])</span>
	<span class="n">c</span><span class="o">=</span><span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
	<span class="n">data_source</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s2">&quot;SELECT well,blockcorr,source_nickname FROM t2wellsource WHERE  source_nickname NOT LIKE&#39;GEN*&#39; ORDER BY source_nickname;&quot;</span><span class="p">,</span><span class="n">conn</span><span class="p">)</span>

	<span class="n">final_t2</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
	<span class="n">output_fi_file</span><span class="o">=</span><span class="s2">&quot;../model/t2/t2.out&quot;</span>

	<span class="n">dictionary_files</span><span class="o">=</span><span class="p">{}</span>

	<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data_source</span><span class="p">)):</span>
		<span class="n">well</span><span class="o">=</span><span class="n">data_source</span><span class="p">[</span><span class="s1">&#39;well&#39;</span><span class="p">][</span><span class="n">n</span><span class="p">]</span>
		<span class="n">blockcorr</span><span class="o">=</span><span class="n">data_source</span><span class="p">[</span><span class="s1">&#39;blockcorr&#39;</span><span class="p">][</span><span class="n">n</span><span class="p">]</span>
		<span class="n">source</span><span class="o">=</span><span class="n">data_source</span><span class="p">[</span><span class="s1">&#39;source_nickname&#39;</span><span class="p">][</span><span class="n">n</span><span class="p">]</span>
		<span class="n">dictionary_files</span><span class="p">[</span><span class="n">well</span><span class="p">]</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;filename&#39;</span><span class="p">:</span><span class="s2">&quot;../output/mh/txt/</span><span class="si">%s</span><span class="s2">_</span><span class="si">%s</span><span class="s2">_</span><span class="si">%s</span><span class="s2">_evol_mh.dat&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">well</span><span class="p">,</span><span class="n">blockcorr</span><span class="p">,</span><span class="n">source</span><span class="p">),</span><span class="s1">&#39;file_container&#39;</span><span class="p">:</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s1">&#39;blockcorr&#39;</span><span class="p">:</span><span class="n">blockcorr</span><span class="p">,</span><span class="s1">&#39;source&#39;</span><span class="p">:</span><span class="n">source</span><span class="p">}</span>
		<span class="n">dictionary_files</span><span class="p">[</span><span class="n">well</span><span class="p">][</span><span class="s1">&#39;file_container&#39;</span><span class="p">]</span><span class="o">+=</span><span class="s2">&quot;ELEMENT,SOURCEINDEX,GENERATION RATE,ENTHALPY,X1,X2,FF(GAS),FF(AQ.),P(WB),TIME</span><span class="se">\n</span><span class="s2">&quot;</span>

	<span class="n">output_t2_file</span><span class="o">=</span><span class="s2">&quot;../model/t2/t2.out&quot;</span>
	<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">output_t2_file</span><span class="p">):</span>
		<span class="n">t2_file</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">output_t2_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">t2_line</span> <span class="ow">in</span> <span class="n">t2_file</span><span class="p">:</span>
			<span class="k">if</span> <span class="s2">&quot;OUTPUT DATA AFTER&quot;</span> <span class="ow">in</span> <span class="n">t2_line</span><span class="p">:</span>
				<span class="n">time</span><span class="o">=</span><span class="n">t2_line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
			<span class="k">for</span> <span class="n">well</span> <span class="ow">in</span> <span class="n">dictionary_files</span><span class="p">:</span>
				<span class="k">if</span> <span class="n">dictionary_files</span><span class="p">[</span><span class="n">well</span><span class="p">][</span><span class="s1">&#39;blockcorr&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">t2_line</span> <span class="ow">and</span> <span class="n">dictionary_files</span><span class="p">[</span><span class="n">well</span><span class="p">][</span><span class="s1">&#39;source&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">t2_line</span><span class="p">:</span>
					<span class="n">t2_array</span><span class="o">=</span><span class="n">t2_line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
					<span class="n">str_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">t2_array</span><span class="p">))</span>
					<span class="n">str_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
					<span class="n">dictionary_files</span><span class="p">[</span><span class="n">well</span><span class="p">][</span><span class="s1">&#39;file_container&#39;</span><span class="p">]</span><span class="o">+=</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">str_list</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
		<span class="n">t2_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;The file </span><span class="si">%s</span><span class="s2"> or directory do not exist&quot;</span><span class="o">%</span><span class="n">output_t2_file</span><span class="p">)</span>

	<span class="k">for</span> <span class="n">well</span> <span class="ow">in</span> <span class="n">dictionary_files</span><span class="p">:</span>
		<span class="n">t2_file_out</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">dictionary_files</span><span class="p">[</span><span class="n">well</span><span class="p">][</span><span class="s1">&#39;filename&#39;</span><span class="p">],</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
		<span class="n">t2_file_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">dictionary_files</span><span class="p">[</span><span class="n">well</span><span class="p">][</span><span class="s1">&#39;file_container&#39;</span><span class="p">])</span>
		<span class="n">t2_file_out</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>	

	<span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

<div class="viewcode-block" id="write_PT_from_t2output_from_prod"><a class="viewcode-back" href="../modules/output.html#output.write_PT_from_t2output_from_prod">[docs]</a><span class="k">def</span> <span class="nf">write_PT_from_t2output_from_prod</span><span class="p">(</span><span class="n">input_dictionary</span><span class="p">,</span><span class="n">sav_version</span><span class="o">=</span><span class="s1">&#39;sav1&#39;</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;It writes a pressure and temperature comming from block on every well in the specified .sav file.</span>

<span class="sd">	Parameters</span>
<span class="sd">	----------</span>
<span class="sd">	input_dictionary : dictionary</span>
<span class="sd">	 Dictionary contaning the path and name of database on keyword &#39;db_path&#39;.</span>
<span class="sd">	sav_version : str</span>
<span class="sd">	  Extension of sav file, i.e. sav, sav1, sav2, etc.</span>

<span class="sd">	Returns</span>
<span class="sd">	-------</span>
<span class="sd">	file</span>
<span class="sd">	  {well_name}_PT.txt: it contains the pressure and temperature information for every well</span>

<span class="sd">	&quot;&quot;&quot;</span>

	<span class="n">db_path</span><span class="o">=</span><span class="n">input_dictionary</span><span class="p">[</span><span class="s1">&#39;db_path&#39;</span><span class="p">]</span>

	<span class="n">wells</span><span class="o">=</span><span class="p">[]</span>

	<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;WELLS&#39;</span><span class="p">,</span><span class="s1">&#39;MAKE_UP_WELLS&#39;</span><span class="p">,</span><span class="s1">&#39;NOT_PRODUCING_WELL&#39;</span><span class="p">]:</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="k">for</span> <span class="n">well</span> <span class="ow">in</span> <span class="n">input_dictionary</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
				<span class="n">wells</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">well</span><span class="p">)</span>
		<span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
			<span class="k">pass</span>

	<span class="n">conn</span><span class="o">=</span><span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">db_path</span><span class="p">)</span>
	<span class="n">c</span><span class="o">=</span><span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

	<span class="c1">#Listing all the wells and assigning them to a well</span>

	<span class="n">blocks_wells</span><span class="o">=</span><span class="p">{}</span>
	<span class="n">wells_data</span><span class="o">=</span><span class="p">{}</span>
	<span class="n">blocks_dictionary</span><span class="o">=</span><span class="p">{}</span>

	<span class="n">data_layer</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s2">&quot;SELECT correlative FROM layers ORDER BY  middle DESC;&quot;</span><span class="p">,</span><span class="n">conn</span><span class="p">)</span>

	<span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">wells</span><span class="p">):</span>
		<span class="n">wells_data</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
		<span class="n">data_block</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s2">&quot;SELECT blockcorr FROM t2wellblock  WHERE well=&#39;</span><span class="si">%s</span><span class="s2">&#39; ORDER BY blockcorr;&quot;</span><span class="o">%</span><span class="n">name</span><span class="p">,</span><span class="n">conn</span><span class="p">)</span>
		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_block</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
			<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">data_layer</span><span class="p">[</span><span class="s1">&#39;correlative&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
				<span class="n">blocks_wells</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="n">data_block</span><span class="p">[</span><span class="s1">&#39;blockcorr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">=</span><span class="n">name</span>

	
	<span class="n">output_sav_file</span><span class="o">=</span><span class="s2">&quot;../model/t2/t2.</span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">sav_version</span>
	<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">output_sav_file</span><span class="p">):</span>
		<span class="n">t2_sav_file</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">output_sav_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
		<span class="n">contidion_found</span><span class="o">=</span><span class="kc">False</span>
		<span class="k">for</span> <span class="n">t2_sav_line</span> <span class="ow">in</span> <span class="n">t2_sav_file</span><span class="p">:</span>
			<span class="k">if</span>  <span class="n">t2_sav_line</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span> <span class="ow">in</span>  <span class="n">blocks_wells</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
				<span class="n">contidion_found</span><span class="o">=</span><span class="kc">True</span>
				<span class="n">well</span><span class="o">=</span><span class="n">blocks_wells</span><span class="p">[</span><span class="n">t2_sav_line</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">]]</span>
				<span class="n">block</span><span class="o">=</span><span class="n">t2_sav_line</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span>
				<span class="k">continue</span>
			<span class="k">if</span> <span class="n">contidion_found</span><span class="p">:</span>
				<span class="n">wells_data</span><span class="p">[</span><span class="n">well</span><span class="p">]</span><span class="o">+=</span><span class="s2">&quot;</span><span class="si">%s%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">block</span><span class="p">,</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">t2_sav_line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)))</span>
				<span class="n">contidion_found</span><span class="o">=</span><span class="kc">False</span>
		<span class="n">t2_sav_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

	<span class="k">for</span> <span class="n">well</span> <span class="ow">in</span> <span class="n">wells_data</span><span class="p">:</span>
		<span class="n">file_out</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="s2">&quot;../output/PT/txt/</span><span class="si">%s</span><span class="s2">_PT.dat&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">well</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
		<span class="n">file_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;ELEM,P,T</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
		<span class="n">file_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">wells_data</span><span class="p">[</span><span class="n">well</span><span class="p">])</span>
		<span class="n">file_out</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

	<span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

<div class="viewcode-block" id="extract_csv_from_t2out"><a class="viewcode-back" href="../modules/output.html#output.extract_csv_from_t2out">[docs]</a><span class="k">def</span> <span class="nf">extract_csv_from_t2out</span><span class="p">(</span><span class="n">json_output</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;It writes the parameter for every block from the last output file of TOUGH2 simulation on csv or json</span>

<span class="sd">	Parameters</span>
<span class="sd">	----------</span>
<span class="sd">	json_output : bool</span>
<span class="sd">	  If True a json file is save on ../output/PT/json/</span>

<span class="sd">	Returns</span>
<span class="sd">	-------</span>
<span class="sd">	file</span>
<span class="sd">	  PT.csv: on ../output/PT/csv/</span>

<span class="sd">	Attention</span>
<span class="sd">	---------</span>
<span class="sd">	The file ELEME.json needs to be updated</span>
<span class="sd">	&quot;&quot;&quot;</span>
	
	<span class="n">eleme_dict</span><span class="o">=</span><span class="p">{}</span>

	<span class="n">ELEME_file</span><span class="o">=</span><span class="s1">&#39;../mesh/ELEME.json&#39;</span>
	<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">ELEME_file</span><span class="p">):</span>
		<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">ELEME_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
		  	<span class="n">blocks_position</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

		<span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">blocks_position</span><span class="p">:</span>
			<span class="n">eleme_dict</span><span class="p">[</span><span class="n">block</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="n">blocks_position</span><span class="p">[</span><span class="n">block</span><span class="p">][</span><span class="s1">&#39;X&#39;</span><span class="p">],</span><span class="n">blocks_position</span><span class="p">[</span><span class="n">block</span><span class="p">][</span><span class="s1">&#39;Y&#39;</span><span class="p">],</span><span class="n">blocks_position</span><span class="p">[</span><span class="n">block</span><span class="p">][</span><span class="s1">&#39;Z&#39;</span><span class="p">]]</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="k">return</span> <span class="s2">&quot;The file </span><span class="si">%s</span><span class="s2"> does not exist&quot;</span><span class="o">%</span><span class="n">ELEME_file</span>

	<span class="n">last</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
	<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="s2">&quot;../model/t2/t2.out&quot;</span><span class="p">):</span>
		<span class="n">t2file</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="s2">&quot;../model/t2/t2.out&quot;</span><span class="p">,</span><span class="s2">&quot;r&quot;</span><span class="p">)</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="k">return</span> <span class="s2">&quot;Theres is not t2.out file on t2/t2.out&quot;</span>


	<span class="n">cnt</span><span class="o">=</span><span class="mi">0</span>
	<span class="n">t2string</span><span class="o">=</span><span class="p">[]</span>
	<span class="c1">#It finds the last section where OUTPUT DATA AFTER was printed and uses it to know where to start to extract data. But also converts every line of the file into an element in an array</span>
	<span class="k">for</span> <span class="n">linet2</span> <span class="ow">in</span> <span class="n">t2file</span><span class="p">:</span>
		<span class="n">cnt</span><span class="o">+=</span><span class="mi">1</span>
		<span class="n">t2string</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">linet2</span><span class="o">.</span><span class="n">rstrip</span><span class="p">())</span>
		<span class="k">if</span> <span class="s2">&quot;OUTPUT DATA AFTER&quot;</span> <span class="ow">in</span> <span class="n">linet2</span><span class="o">.</span><span class="n">rstrip</span><span class="p">():</span>
			<span class="n">last</span><span class="o">=</span><span class="n">linet2</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
			<span class="n">line</span><span class="o">=</span><span class="n">cnt</span>
	<span class="n">t2file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

	<span class="n">high_iteration</span><span class="o">=</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">last</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()]</span>

	<span class="k">for</span> <span class="n">elementx</span> <span class="ow">in</span> <span class="n">eleme_dict</span><span class="p">:</span>
		<span class="n">cnt2</span><span class="o">=</span><span class="mi">0</span>
		<span class="k">for</span> <span class="n">lineout</span> <span class="ow">in</span> <span class="n">t2string</span><span class="p">[</span><span class="n">line</span><span class="o">+</span><span class="n">cnt2</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
			<span class="k">if</span> <span class="s2">&quot; @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&quot;</span><span class="o">==</span><span class="n">lineout</span><span class="p">:</span>
				<span class="n">cnt2</span><span class="o">+=</span><span class="mi">1</span>
			<span class="k">elif</span> <span class="n">cnt2</span><span class="o">&gt;</span><span class="mi">2</span><span class="p">:</span>
				<span class="k">break</span>
			<span class="k">elif</span> <span class="n">elementx</span> <span class="ow">in</span> <span class="n">lineout</span><span class="p">:</span>
				<span class="n">lineselect</span><span class="o">=</span><span class="n">lineout</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
				<span class="n">eleme_dict</span><span class="p">[</span><span class="n">elementx</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">lineselect</span><span class="p">)</span>
				<span class="k">break</span>

	<span class="n">csv_columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">,</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span><span class="s1">&#39;ELEM&#39;</span><span class="p">,</span><span class="s1">&#39;INDEX&#39;</span><span class="p">,</span><span class="s1">&#39;P&#39;</span><span class="p">,</span><span class="s1">&#39;T&#39;</span><span class="p">,</span><span class="s1">&#39;SG&#39;</span><span class="p">,</span><span class="s1">&#39;SW&#39;</span><span class="p">,</span><span class="s1">&#39;X(WAT1)&#39;</span><span class="p">,</span><span class="s1">&#39;X(WAT2)&#39;</span><span class="p">,</span><span class="s1">&#39;PCAP&#39;</span><span class="p">,</span><span class="s1">&#39;DG&#39;</span><span class="p">,</span><span class="s1">&#39;DW&#39;</span><span class="p">]</span>

	<span class="k">if</span> <span class="n">json_output</span><span class="p">:</span>
		<span class="n">eleme_pd</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">eleme_dict</span><span class="p">,</span><span class="n">orient</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">,</span><span class="n">columns</span><span class="o">=</span><span class="n">csv_columns</span><span class="p">)</span>
		<span class="n">dtype</span><span class="o">=</span> <span class="p">{</span><span class="s1">&#39;X&#39;</span><span class="p">:</span><span class="s1">&#39;float&#39;</span><span class="p">,</span>
				 <span class="s1">&#39;Y&#39;</span><span class="p">:</span><span class="s1">&#39;float&#39;</span><span class="p">,</span>
				 <span class="s1">&#39;Z&#39;</span><span class="p">:</span><span class="s1">&#39;float&#39;</span><span class="p">,</span>
				 <span class="s1">&#39;ELEM&#39;</span><span class="p">:</span><span class="s1">&#39;str&#39;</span><span class="p">,</span>
				 <span class="s1">&#39;INDEX&#39;</span><span class="p">:</span><span class="s1">&#39;float&#39;</span><span class="p">,</span>
				 <span class="s1">&#39;P&#39;</span><span class="p">:</span><span class="s1">&#39;float&#39;</span><span class="p">,</span>
				 <span class="s1">&#39;T&#39;</span><span class="p">:</span><span class="s1">&#39;float&#39;</span><span class="p">,</span>
				 <span class="s1">&#39;SG&#39;</span><span class="p">:</span><span class="s1">&#39;float&#39;</span><span class="p">,</span>
				 <span class="s1">&#39;SW&#39;</span><span class="p">:</span><span class="s1">&#39;float&#39;</span><span class="p">,</span>
				 <span class="s1">&#39;X(WAT1)&#39;</span><span class="p">:</span><span class="s1">&#39;float&#39;</span><span class="p">,</span>
				 <span class="s1">&#39;X(WAT2)&#39;</span><span class="p">:</span><span class="s1">&#39;float&#39;</span><span class="p">,</span>
				 <span class="s1">&#39;PCAP&#39;</span><span class="p">:</span><span class="s1">&#39;float&#39;</span><span class="p">,</span>
				 <span class="s1">&#39;DG&#39;</span><span class="p">:</span><span class="s1">&#39;float&#39;</span><span class="p">,</span>
				 <span class="s1">&#39;DW&#39;</span><span class="p">:</span><span class="s1">&#39;float&#39;</span><span class="p">}</span>
		<span class="n">eleme_pd</span><span class="o">=</span> <span class="n">eleme_pd</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>
		<span class="n">eleme_pd</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="s2">&quot;../output/PT/json/PT_json.txt&quot;</span><span class="p">,</span><span class="n">orient</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">,</span><span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

	<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;../output/PT/csv/PT.csv&quot;</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
		<span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">csv_columns</span><span class="p">))</span>
		<span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">eleme_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
			<span class="n">string</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
			<span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">eleme_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
				<span class="n">string</span><span class="o">+=</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">,&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
			<span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">string</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>
			<span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
	<span class="n">file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Erick Jimenez

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>