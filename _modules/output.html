

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>output &mdash; T2GEORES  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> T2GEORES
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../modules/gener.html">gener</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/geometry.html">geometry</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/it2Obs.html">it2Obs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/model_plots.html">model_plots</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/output.html">output</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/regeo_mesh.html">regeo_mesh</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/run.html">run</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/t2geores_functions.html">t2geores_functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/txt2sqlite.html">txt2sqlite</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/writer.html">writer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/formats.html">formats</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/report.html">report</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">T2GEORES</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Module code</a> &raquo;</li>
        
      <li>output</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for output</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">csv</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">sqlite3</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">T2GEORES</span> <span class="kn">import</span> <span class="n">formats</span> <span class="k">as</span> <span class="n">formats</span>
<span class="kn">from</span> <span class="nn">T2GEORES</span> <span class="kn">import</span> <span class="n">geometry</span> <span class="k">as</span> <span class="n">geometry</span>
<span class="kn">from</span> <span class="nn">iapws</span> <span class="kn">import</span> <span class="n">IAPWS97</span>

<div class="viewcode-block" id="write_PT_from_t2output"><a class="viewcode-back" href="../modules/output.html#output.write_PT_from_t2output">[docs]</a><span class="k">def</span> <span class="nf">write_PT_from_t2output</span><span class="p">(</span><span class="n">input_dictionary</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;It writes the parameter for every block from every well from the last output file of TOUGH2 simulation</span>

<span class="sd">	Parameters</span>
<span class="sd">	----------</span>
<span class="sd">	input_dictionary : dictionary</span>
<span class="sd">	 Dictionary contaning the path and name of database on keyword &#39;db_path&#39;, list of wells under the keywords &#39;WELLS&#39;, &#39;MAKE_UP_WELLS&#39; and &#39;NOT_PRODUCING_WELL&#39;</span>

<span class="sd">	Returns</span>
<span class="sd">	-------</span>
<span class="sd">	file</span>
<span class="sd">	  {well_name}_PT.txt: file containing the information for every block from every well</span>

<span class="sd">	Attention</span>
<span class="sd">	---------</span>
<span class="sd">	The layers and well block need  to be on the databse</span>

<span class="sd">	Examples</span>
<span class="sd">	--------</span>
<span class="sd">	&gt;&gt;&gt; write_PT_from_t2output(input_dictionary)</span>
<span class="sd">	&quot;&quot;&quot;</span>

	<span class="n">wells</span><span class="o">=</span><span class="p">[]</span>

	<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;WELLS&#39;</span><span class="p">,</span><span class="s1">&#39;MAKE_UP_WELLS&#39;</span><span class="p">,</span><span class="s1">&#39;NOT_PRODUCING_WELL&#39;</span><span class="p">]:</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="k">for</span> <span class="n">well</span> <span class="ow">in</span> <span class="n">input_dictionary</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
				<span class="n">wells</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">well</span><span class="p">)</span>
		<span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
			<span class="k">pass</span>

	<span class="n">db_path</span><span class="o">=</span><span class="n">input_dictionary</span><span class="p">[</span><span class="s1">&#39;db_path&#39;</span><span class="p">]</span>

	<span class="n">t2_output_file</span><span class="o">=</span><span class="s2">&quot;../model/t2/t2.out&quot;</span>
	<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">t2_output_file</span><span class="p">):</span>
		<span class="k">pass</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="k">return</span> <span class="s2">&quot;Theres is not t2.out file on t2/t2.out&quot;</span>

	<span class="c1">#Extracts all the times the line &#39;OUTPUT DATA AFTER&#39; was printed</span>
	<span class="n">output_headers</span><span class="o">=</span><span class="p">[]</span>
	<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">t2_output_file</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">t2_file</span><span class="p">:</span>
		<span class="n">t2_output_array</span> <span class="o">=</span> <span class="n">t2_file</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
		<span class="k">for</span> <span class="n">line_i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">t2_output_array</span><span class="p">):</span>
			<span class="k">if</span> <span class="s2">&quot;OUTPUT DATA AFTER&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">():</span>
				<span class="n">output_headers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line_i</span><span class="p">)</span>

	<span class="n">conn</span><span class="o">=</span><span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">db_path</span><span class="p">)</span>
	<span class="n">c</span><span class="o">=</span><span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

	<span class="c1">#Create a dictionary containing all the blocks in a well</span>

	<span class="n">blocks_wells</span><span class="o">=</span><span class="p">{}</span>
	<span class="n">wells_data</span><span class="o">=</span><span class="p">{}</span>

	<span class="n">data_layer</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s2">&quot;SELECT correlative FROM layers ORDER BY  middle DESC;&quot;</span><span class="p">,</span><span class="n">conn</span><span class="p">)</span>
	<span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">wells</span><span class="p">):</span>
		<span class="n">wells_data</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
		<span class="n">data_block</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s2">&quot;SELECT blockcorr FROM t2wellblock  WHERE well=&#39;</span><span class="si">%s</span><span class="s2">&#39; ORDER BY blockcorr;&quot;</span><span class="o">%</span><span class="n">name</span><span class="p">,</span><span class="n">conn</span><span class="p">)</span>
		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_block</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
			<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">data_layer</span><span class="p">[</span><span class="s1">&#39;correlative&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
				<span class="n">blocks_wells</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="n">data_block</span><span class="p">[</span><span class="s1">&#39;blockcorr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">=</span><span class="n">name</span>
	
	<span class="c1">#Select the last line of TOUGH2 output file</span>
	<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">t2_output_array</span><span class="p">[</span><span class="n">output_headers</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
		<span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">blocks_wells</span><span class="p">:</span>
			<span class="k">if</span>  <span class="n">block</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">())</span><span class="o">==</span><span class="mi">12</span><span class="p">:</span> <span class="c1">#11</span>
				<span class="n">wells_data</span><span class="p">[</span><span class="n">blocks_wells</span><span class="p">[</span><span class="n">block</span><span class="p">]]</span><span class="o">+=</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()))</span>

	<span class="c1">#Writes an output file for every well</span>
	<span class="k">for</span> <span class="n">well</span> <span class="ow">in</span> <span class="n">wells_data</span><span class="p">:</span>
		<span class="n">file_out</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="s2">&quot;../output/PT/txt/</span><span class="si">%s</span><span class="s2">_PT.dat&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">well</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
		<span class="n">file_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;ELEM,INDEX,P,T,SG,SW,X(WAT1),X(WAT2),PCAP,DG,DW,LOG(PERM)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
		<span class="n">file_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">wells_data</span><span class="p">[</span><span class="n">well</span><span class="p">])</span>
		<span class="n">file_out</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

	<span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>
	
<div class="viewcode-block" id="from_sav_to_json"><a class="viewcode-back" href="../modules/output.html#output.from_sav_to_json">[docs]</a><span class="k">def</span> <span class="nf">from_sav_to_json</span><span class="p">(</span><span class="n">sav_version</span><span class="o">=</span><span class="s1">&#39;sav1&#39;</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;It writes a json file with temperature and pressure data from the specified .sav for every block including coordinates</span>
<span class="sd">	</span>
<span class="sd">	Parameters</span>
<span class="sd">	----------</span>
<span class="sd">	sav_version : str</span>
<span class="sd">	  Extension of sav file, i.e. sav, sav1, sav2, etc.</span>

<span class="sd">	Returns</span>
<span class="sd">	-------</span>
<span class="sd">	file</span>
<span class="sd">	  PT_json_from_sav.txt : on  ../output/PT/json/</span>

<span class="sd">	Attention</span>
<span class="sd">	---------</span>
<span class="sd">	The ELEME.json file needs to be updated</span>

<span class="sd">	Examples</span>
<span class="sd">	--------</span>
<span class="sd">	&gt;&gt;&gt; from_sav_to_json(sav_version=&#39;sav1&#39;)</span>
<span class="sd">	&quot;&quot;&quot;</span>

	<span class="n">output_sav_file</span><span class="o">=</span><span class="s2">&quot;../model/t2/</span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">sav_version</span>

	<span class="c1">#Generates a dictionary with block as keyword and x,y,z coordinates</span>
	<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;../mesh/ELEME.json&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
	  	<span class="n">blocks_position</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

	<span class="n">eleme_dict</span><span class="o">=</span><span class="p">{}</span>
	<span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">blocks_position</span><span class="p">:</span>
		<span class="n">eleme_dict</span><span class="p">[</span><span class="n">block</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="n">blocks_position</span><span class="p">[</span><span class="n">block</span><span class="p">][</span><span class="s1">&#39;X&#39;</span><span class="p">],</span><span class="n">blocks_position</span><span class="p">[</span><span class="n">block</span><span class="p">][</span><span class="s1">&#39;Y&#39;</span><span class="p">],</span><span class="n">blocks_position</span><span class="p">[</span><span class="n">block</span><span class="p">][</span><span class="s1">&#39;Z&#39;</span><span class="p">]]</span>

	<span class="c1">#Creates a string from .sav file</span>
	<span class="n">savfile</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">output_sav_file</span><span class="p">,</span><span class="s2">&quot;r&quot;</span><span class="p">)</span>
	<span class="n">savstring</span><span class="o">=</span><span class="p">[]</span>
	<span class="k">for</span> <span class="n">linesav</span> <span class="ow">in</span> <span class="n">savfile</span><span class="p">:</span>
		<span class="n">savstring</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">linesav</span><span class="o">.</span><span class="n">rstrip</span><span class="p">())</span>
	<span class="n">savfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

	<span class="c1">#Stores Pressure and Temperature on the dictionary</span>
	<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">output_sav_file</span><span class="p">):</span>
		<span class="n">t2_sav_file</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">output_sav_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
		<span class="n">contidion_found</span><span class="o">=</span><span class="kc">False</span>
		<span class="k">for</span> <span class="n">t2_sav_line</span> <span class="ow">in</span> <span class="n">t2_sav_file</span><span class="p">:</span>
			<span class="k">if</span>  <span class="n">t2_sav_line</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span> <span class="ow">in</span>  <span class="n">eleme_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
				<span class="n">contidion_found</span><span class="o">=</span><span class="kc">True</span>
				<span class="n">block</span><span class="o">=</span><span class="n">t2_sav_line</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span>
				<span class="k">continue</span>
			<span class="k">if</span> <span class="n">contidion_found</span><span class="p">:</span>
				<span class="n">eleme_dict</span><span class="p">[</span><span class="n">block</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">t2_sav_line</span><span class="o">.</span><span class="n">split</span><span class="p">()])</span>
				<span class="n">contidion_found</span><span class="o">=</span><span class="kc">False</span>
		<span class="n">t2_sav_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

	<span class="n">eleme_pd</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">eleme_dict</span><span class="p">,</span><span class="n">orient</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">,</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span><span class="s1">&#39;P&#39;</span><span class="p">,</span><span class="s1">&#39;T&#39;</span><span class="p">])</span>
	<span class="n">eleme_pd</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="s2">&quot;../output/PT/json/PT_json_from_sav.json&quot;</span><span class="p">,</span><span class="n">orient</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">,</span><span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span></div>

<div class="viewcode-block" id="PTjson_to_sqlite"><a class="viewcode-back" href="../modules/output.html#output.PTjson_to_sqlite">[docs]</a><span class="k">def</span> <span class="nf">PTjson_to_sqlite</span><span class="p">(</span><span class="n">input_dictionary</span><span class="p">,</span><span class="n">source</span><span class="o">=</span><span class="s1">&#39;t2&#39;</span><span class="p">,):</span>
	<span class="sd">&quot;&quot;&quot;It stores the defined json file into the database on the table t2PTout</span>
<span class="sd">	</span>
<span class="sd">	Parameters</span>
<span class="sd">	----------</span>
<span class="sd">	source : str</span>
<span class="sd">	  It can be &#39;t2&#39; or &#39;sav&#39;</span>
<span class="sd">	input_dictionary : dictionary</span>
<span class="sd">	 Dictionary contaning the path and name of database on keyword &#39;db_path&#39;.</span>

<span class="sd">	Examples</span>
<span class="sd">	--------</span>
<span class="sd">	&gt;&gt;&gt; PTjson_to_sqlite(&quot;t2&quot;)</span>
<span class="sd">	&quot;&quot;&quot;</span>

	<span class="n">db_path</span><span class="o">=</span><span class="n">input_dictionary</span><span class="p">[</span><span class="s1">&#39;db_path&#39;</span><span class="p">]</span>

	<span class="n">conn</span><span class="o">=</span><span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">db_path</span><span class="p">)</span>
	<span class="n">c</span><span class="o">=</span><span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
	<span class="k">if</span> <span class="n">source</span><span class="o">==</span><span class="s2">&quot;t2&quot;</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="s2">&quot;../output/PT/json/PT_json.txt&quot;</span><span class="p">):</span>
			<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;../output/PT/json/PT_json.txt&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
				<span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
			<span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
				<span class="k">try</span><span class="p">:</span>
					<span class="n">q</span><span class="o">=</span><span class="s2">&quot;INSERT INTO t2PTout(blockcorr,x,y,z,&#39;index&#39;,P,T,SG,SW,X1,X2,PCAP,DG,DW) </span><span class="se">\</span>
<span class="s2">					VALUES (&#39;</span><span class="si">%s</span><span class="s2">&#39;,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">)&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">element</span><span class="p">,</span>	<span class="n">data</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="s1">&#39;X&#39;</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="s1">&#39;Y&#39;</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="s1">&#39;Z&#39;</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="s1">&#39;INDEX&#39;</span><span class="p">],</span>\
																			<span class="n">data</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="s1">&#39;P&#39;</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="s1">&#39;T&#39;</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="s1">&#39;SG&#39;</span><span class="p">],</span>\
																			<span class="n">data</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="s1">&#39;SW&#39;</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="s1">&#39;X(WAT1)&#39;</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="s1">&#39;X(WAT2)&#39;</span><span class="p">],</span>\
																			<span class="n">data</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="s1">&#39;PCAP&#39;</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="s1">&#39;DG&#39;</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="s1">&#39;DW&#39;</span><span class="p">])</span>

					<span class="n">c</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
				<span class="k">except</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">IntegrityError</span><span class="p">:</span>
					<span class="n">q</span><span class="o">=</span><span class="s2">&quot;UPDATE t2PTout SET </span><span class="se">\</span>
<span class="s2">					x=</span><span class="si">%s</span><span class="s2">, </span><span class="se">\</span>
<span class="s2">					y=</span><span class="si">%s</span><span class="s2">, </span><span class="se">\</span>
<span class="s2">					z=</span><span class="si">%s</span><span class="s2">, </span><span class="se">\</span>
<span class="s2">					&#39;index&#39;=</span><span class="si">%s</span><span class="s2">, </span><span class="se">\</span>
<span class="s2">					P=</span><span class="si">%s</span><span class="s2">, </span><span class="se">\</span>
<span class="s2">					T=</span><span class="si">%s</span><span class="s2">, </span><span class="se">\</span>
<span class="s2">					SG=</span><span class="si">%s</span><span class="s2">, </span><span class="se">\</span>
<span class="s2">					SW=</span><span class="si">%s</span><span class="s2">, </span><span class="se">\</span>
<span class="s2">					X1=</span><span class="si">%s</span><span class="s2">, </span><span class="se">\</span>
<span class="s2">					X2=</span><span class="si">%s</span><span class="s2">, </span><span class="se">\</span>
<span class="s2">					PCAP=</span><span class="si">%s</span><span class="s2">, </span><span class="se">\</span>
<span class="s2">					DG=</span><span class="si">%s</span><span class="s2">, </span><span class="se">\</span>
<span class="s2">					DW=</span><span class="si">%s</span><span class="s2"> </span><span class="se">\</span>
<span class="s2">					WHERE blockcorr=&#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span><span class="o">%</span><span class="p">(</span>	<span class="n">data</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="s1">&#39;X&#39;</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="s1">&#39;Y&#39;</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="s1">&#39;Z&#39;</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="s1">&#39;INDEX&#39;</span><span class="p">],</span>\
											<span class="n">data</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="s1">&#39;P&#39;</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="s1">&#39;T&#39;</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="s1">&#39;SG&#39;</span><span class="p">],</span>\
											<span class="n">data</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="s1">&#39;SW&#39;</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="s1">&#39;X(WAT1)&#39;</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="s1">&#39;X(WAT2)&#39;</span><span class="p">],</span>\
											<span class="n">data</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="s1">&#39;PCAP&#39;</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="s1">&#39;DG&#39;</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="s1">&#39;DW&#39;</span><span class="p">],</span><span class="n">element</span><span class="p">)</span>
					<span class="n">c</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
				<span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
	<span class="k">elif</span> <span class="n">source</span><span class="o">==</span><span class="s2">&quot;sav&quot;</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="s2">&quot;../output/PT/json/PT_json_from_sav.txt&quot;</span><span class="p">):</span>
			<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;../output/PT/json/PT_json_from_sav.txt&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
				<span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
			<span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
				<span class="k">try</span><span class="p">:</span>
					<span class="n">q</span><span class="o">=</span><span class="s2">&quot;INSERT INTO t2PTout(blockcorr,x,y,z,P,T) </span><span class="se">\</span>
<span class="s2">					VALUES (&#39;</span><span class="si">%s</span><span class="s2">&#39;,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">)&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">element</span><span class="p">,</span>\
												   <span class="n">data</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="s1">&#39;X&#39;</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="s1">&#39;Y&#39;</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="s1">&#39;Z&#39;</span><span class="p">],</span>\
												   <span class="n">data</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="s1">&#39;P&#39;</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="s1">&#39;T&#39;</span><span class="p">])</span>
					<span class="n">c</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
				<span class="k">except</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">IntegrityError</span><span class="p">:</span>
					<span class="n">q</span><span class="o">=</span><span class="s2">&quot;UPDATE t2PTout SET </span><span class="se">\</span>
<span class="s2">					x=</span><span class="si">%s</span><span class="s2">, </span><span class="se">\</span>
<span class="s2">					y=</span><span class="si">%s</span><span class="s2">, </span><span class="se">\</span>
<span class="s2">					z=</span><span class="si">%s</span><span class="s2">, </span><span class="se">\</span>
<span class="s2">					P=</span><span class="si">%s</span><span class="s2">, </span><span class="se">\</span>
<span class="s2">					T=</span><span class="si">%s</span><span class="s2"> </span><span class="se">\</span>
<span class="s2">					WHERE blockcorr=&#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="s1">&#39;ELEM&#39;</span><span class="p">],</span>\
										   <span class="n">data</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="s1">&#39;X&#39;</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="s1">&#39;Y&#39;</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="s1">&#39;Z&#39;</span><span class="p">],</span>\
										   <span class="n">data</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="s1">&#39;P&#39;</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="s1">&#39;T&#39;</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="s1">&#39;ELEM&#39;</span><span class="p">])</span>
					<span class="n">c</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
				<span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

	<span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

<div class="viewcode-block" id="write_PT_of_wells_from_t2output_in_time"><a class="viewcode-back" href="../modules/output.html#output.write_PT_of_wells_from_t2output_in_time">[docs]</a><span class="k">def</span> <span class="nf">write_PT_of_wells_from_t2output_in_time</span><span class="p">(</span><span class="n">input_dictionary</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;It generates file containing the evolution of every block on every well</span>

<span class="sd">	Extrae la evolucion de los bloques relacionados de todos los pozos en la direccion &quot;../output/PT/evol&quot;</span>
<span class="sd">	</span>
<span class="sd">	Parameters</span>
<span class="sd">	----------</span>
<span class="sd">	input_dictionary : dictionary</span>
<span class="sd">	  Dictionary contaning the path and name of database on keyword &#39;db_path&#39;, list of wells under the keywords &#39;WELLS&#39;, &#39;MAKE_UP_WELLS&#39; and &#39;NOT_PRODUCING_WELL&#39;</span>

<span class="sd">	Returns</span>
<span class="sd">	-------</span>
<span class="sd">	file</span>
<span class="sd">	  {well}_PT_{layer}.txt : on  ../output/PT/evol</span>

<span class="sd">	Examples</span>
<span class="sd">	--------</span>
<span class="sd">	&gt;&gt;&gt; write_PT_of_wells_from_t2output_in_time(input_dictionary)</span>
<span class="sd">	&quot;&quot;&quot;</span>

	<span class="n">db_path</span><span class="o">=</span><span class="n">input_dictionary</span><span class="p">[</span><span class="s1">&#39;db_path&#39;</span><span class="p">]</span>

	<span class="n">wells</span><span class="o">=</span><span class="p">[]</span>

	<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;WELLS&#39;</span><span class="p">,</span><span class="s1">&#39;MAKE_UP_WELLS&#39;</span><span class="p">,</span><span class="s1">&#39;NOT_PRODUCING_WELL&#39;</span><span class="p">]:</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="k">for</span> <span class="n">well</span> <span class="ow">in</span> <span class="n">input_dictionary</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
				<span class="n">wells</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">well</span><span class="p">)</span>
		<span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
			<span class="k">pass</span>

	<span class="n">conn</span><span class="o">=</span><span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">db_path</span><span class="p">)</span>
	<span class="n">c</span><span class="o">=</span><span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

	<span class="n">blocks_wells</span><span class="o">=</span><span class="p">{}</span>
	<span class="n">blocks_data</span><span class="o">=</span><span class="p">{}</span>

	<span class="c1">#Generates a dictionary with the blocks on a well as a keyword </span>
	<span class="n">data_layer</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s2">&quot;SELECT correlative FROM layers ORDER BY  middle DESC;&quot;</span><span class="p">,</span><span class="n">conn</span><span class="p">)</span>
	<span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">wells</span><span class="p">):</span>
		<span class="n">data_block</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s2">&quot;SELECT blockcorr FROM t2wellblock  WHERE well=&#39;</span><span class="si">%s</span><span class="s2">&#39; ORDER BY blockcorr;&quot;</span><span class="o">%</span><span class="n">name</span><span class="p">,</span><span class="n">conn</span><span class="p">)</span>
		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_block</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
			<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">data_layer</span><span class="p">[</span><span class="s1">&#39;correlative&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
				<span class="n">blocks_wells</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="n">data_block</span><span class="p">[</span><span class="s1">&#39;blockcorr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">=</span><span class="n">name</span>
				<span class="n">blocks_data</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="n">data_block</span><span class="p">[</span><span class="s1">&#39;blockcorr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">=</span><span class="s2">&quot;&quot;</span>

	<span class="c1">#Explore the TOUGH2 output file line by line and store the information if the block list generated on the previous step is on the line.</span>
	<span class="n">output_t2_file</span><span class="o">=</span><span class="s2">&quot;../model/t2/t2.out&quot;</span>
	<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">output_t2_file</span><span class="p">):</span>
		<span class="n">t2_file</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">output_t2_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">t2_line</span> <span class="ow">in</span> <span class="n">t2_file</span><span class="p">:</span>
			<span class="k">if</span> <span class="s2">&quot;OUTPUT DATA AFTER&quot;</span> <span class="ow">in</span> <span class="n">t2_line</span><span class="p">:</span>
				<span class="n">time</span><span class="o">=</span><span class="n">t2_line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
			<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">t2_line</span><span class="o">.</span><span class="n">split</span><span class="p">())</span><span class="o">==</span><span class="mi">11</span> <span class="ow">and</span> <span class="n">t2_line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">blocks_data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
				<span class="n">t2_array</span><span class="o">=</span><span class="n">t2_line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
				<span class="n">data_list</span><span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">t2_array</span><span class="p">))</span>
				<span class="n">data_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
				<span class="n">blocks_data</span><span class="p">[</span><span class="n">t2_line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]]</span><span class="o">+=</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_list</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
		<span class="n">t2_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;The file </span><span class="si">%s</span><span class="s2"> or directory do not exist&quot;</span><span class="o">%</span><span class="n">output_t2_file</span><span class="p">)</span>

	<span class="c1">#Store the data from the dictionary in files</span>
	<span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">blocks_data</span><span class="p">:</span>
		<span class="n">evol_file_out</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="s2">&quot;../output/PT/evol/</span><span class="si">%s</span><span class="s2">_PT_</span><span class="si">%s</span><span class="s2">_evol.dat&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">blocks_wells</span><span class="p">[</span><span class="n">block</span><span class="p">],</span><span class="n">block</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
		<span class="n">evol_file_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;ELEM,INDEX,P,T,SG,SW,X(WAT1),X(WAT2),PCAP,DG,DW,TIME</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
		<span class="n">evol_file_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">blocks_data</span><span class="p">[</span><span class="n">block</span><span class="p">])</span>
		<span class="n">evol_file_out</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>	
	<span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

<div class="viewcode-block" id="gen_evol"><a class="viewcode-back" href="../modules/output.html#output.gen_evol">[docs]</a><span class="k">def</span> <span class="nf">gen_evol</span><span class="p">(</span><span class="n">input_dictionary</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;It generates an output file containing flow and flowing enthalpy for each GEN element. As a convention the library it is suggested to use GEN for any source/sink that is not a well</span>

<span class="sd">	Parameters</span>
<span class="sd">	----------</span>
<span class="sd">	input_dictionary : dictionary</span>
<span class="sd">	 Dictionary contaning the path and name of database on keyword &#39;db_path&#39;.</span>

<span class="sd">	Returns</span>
<span class="sd">	-------</span>
<span class="sd">	file</span>
<span class="sd">	  {GEN}_{BLOCK}_{NICKNAME}.txt : on  ../output/mh/txt</span>

<span class="sd">	&quot;&quot;&quot;</span>

	<span class="n">db_path</span><span class="o">=</span><span class="n">input_dictionary</span><span class="p">[</span><span class="s1">&#39;db_path&#39;</span><span class="p">]</span>

	<span class="c1">#List the GEN elements</span>
	<span class="n">conn</span><span class="o">=</span><span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">db_path</span><span class="p">)</span>
	<span class="n">c</span><span class="o">=</span><span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
	<span class="n">data_source</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s2">&quot;SELECT well,blockcorr,source_nickname FROM t2wellsource WHERE  source_nickname LIKE&#39;GEN*&#39; ORDER BY source_nickname;&quot;</span><span class="p">,</span><span class="n">conn</span><span class="p">)</span>

	<span class="n">final_t2</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
	<span class="n">output_fi_file</span><span class="o">=</span><span class="s2">&quot;../model/t2/t2.out&quot;</span>

	<span class="c1">#Initialize a dictionary containing the file path and name.</span>
	<span class="n">dictionary_files</span><span class="o">=</span><span class="p">{}</span>
	<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data_source</span><span class="p">)):</span>
		<span class="n">well</span><span class="o">=</span><span class="n">data_source</span><span class="p">[</span><span class="s1">&#39;well&#39;</span><span class="p">][</span><span class="n">n</span><span class="p">]</span>
		<span class="n">blockcorr</span><span class="o">=</span><span class="n">data_source</span><span class="p">[</span><span class="s1">&#39;blockcorr&#39;</span><span class="p">][</span><span class="n">n</span><span class="p">]</span>
		<span class="n">source</span><span class="o">=</span><span class="n">data_source</span><span class="p">[</span><span class="s1">&#39;source_nickname&#39;</span><span class="p">][</span><span class="n">n</span><span class="p">]</span>
		<span class="n">dictionary_files</span><span class="p">[</span><span class="n">well</span><span class="p">]</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;filename&#39;</span><span class="p">:</span><span class="s2">&quot;../output/mh/txt/</span><span class="si">%s</span><span class="s2">_</span><span class="si">%s</span><span class="s2">_</span><span class="si">%s</span><span class="s2">_evol_mh.dat&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">well</span><span class="p">,</span><span class="n">blockcorr</span><span class="p">,</span><span class="n">source</span><span class="p">),</span><span class="s1">&#39;file_container&#39;</span><span class="p">:</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s1">&#39;blockcorr&#39;</span><span class="p">:</span><span class="n">blockcorr</span><span class="p">,</span><span class="s1">&#39;source&#39;</span><span class="p">:</span><span class="n">source</span><span class="p">}</span>
		<span class="n">dictionary_files</span><span class="p">[</span><span class="n">well</span><span class="p">][</span><span class="s1">&#39;file_container&#39;</span><span class="p">]</span><span class="o">+=</span><span class="s2">&quot;ELEMENT,SOURCEINDEX,GENERATION RATE,ENTHALPY,X1,X2,FF(GAS),FF(AQ.),P(WB),TIME</span><span class="se">\n</span><span class="s2">&quot;</span>

	<span class="c1">#It reads the TOUGH2 output file line by line and store the data from each GEN element</span>
	<span class="n">output_t2_file</span><span class="o">=</span><span class="s2">&quot;../model/t2/t2.out&quot;</span>
	<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">output_t2_file</span><span class="p">):</span>
		<span class="n">t2_file</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">output_t2_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">t2_line</span> <span class="ow">in</span> <span class="n">t2_file</span><span class="p">:</span>
			<span class="k">if</span> <span class="s2">&quot;OUTPUT DATA AFTER&quot;</span> <span class="ow">in</span> <span class="n">t2_line</span><span class="p">:</span>
				<span class="n">time</span><span class="o">=</span><span class="n">t2_line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
			<span class="k">for</span> <span class="n">well</span> <span class="ow">in</span> <span class="n">dictionary_files</span><span class="p">:</span>
				<span class="k">if</span> <span class="n">dictionary_files</span><span class="p">[</span><span class="n">well</span><span class="p">][</span><span class="s1">&#39;blockcorr&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">t2_line</span> <span class="ow">and</span> <span class="n">dictionary_files</span><span class="p">[</span><span class="n">well</span><span class="p">][</span><span class="s1">&#39;source&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">t2_line</span><span class="p">:</span>
					<span class="n">t2_array</span><span class="o">=</span><span class="n">t2_line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
					<span class="n">str_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">t2_array</span><span class="p">))</span>
					<span class="n">str_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
					<span class="n">dictionary_files</span><span class="p">[</span><span class="n">well</span><span class="p">][</span><span class="s1">&#39;file_container&#39;</span><span class="p">]</span><span class="o">+=</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">str_list</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
		<span class="n">t2_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;The file </span><span class="si">%s</span><span class="s2"> or directory do not exist&quot;</span><span class="o">%</span><span class="n">output_t2_file</span><span class="p">)</span>

	<span class="c1">#Creates a file for every GEN elemen</span>
	<span class="k">for</span> <span class="n">well</span> <span class="ow">in</span> <span class="n">dictionary_files</span><span class="p">:</span>
		<span class="n">t2_file_out</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">dictionary_files</span><span class="p">[</span><span class="n">well</span><span class="p">][</span><span class="s1">&#39;filename&#39;</span><span class="p">],</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
		<span class="n">t2_file_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">dictionary_files</span><span class="p">[</span><span class="n">well</span><span class="p">][</span><span class="s1">&#39;file_container&#39;</span><span class="p">])</span>
		<span class="n">t2_file_out</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>	

	<span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

<div class="viewcode-block" id="src_evol"><a class="viewcode-back" href="../modules/output.html#output.src_evol">[docs]</a><span class="k">def</span> <span class="nf">src_evol</span><span class="p">(</span><span class="n">input_dictionary</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;It generates an output file containing flow and flowing enthalpy for each SRC element. As a convention the library it is suggested to use SRC for any source/sink that is a well</span>

<span class="sd">	Parameters</span>
<span class="sd">	----------</span>
<span class="sd">	input_dictionary : dictionary</span>
<span class="sd">	 Dictionary contaning the path and name of database on keyword &#39;db_path&#39;.</span>

<span class="sd">	Returns</span>
<span class="sd">	-------</span>
<span class="sd">	file</span>
<span class="sd">	  {GEN}_{BLOCK}_{NICKNAME}.txt : on  ../output/mh/txt</span>

<span class="sd">	&quot;&quot;&quot;</span>

	<span class="c1">#See comment for gen_evol</span>

	<span class="n">db_path</span><span class="o">=</span><span class="n">input_dictionary</span><span class="p">[</span><span class="s1">&#39;db_path&#39;</span><span class="p">]</span>

	<span class="n">conn</span><span class="o">=</span><span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">input_data</span><span class="p">[</span><span class="s1">&#39;db_path&#39;</span><span class="p">])</span>
	<span class="n">c</span><span class="o">=</span><span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
	<span class="n">data_source</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s2">&quot;SELECT well,blockcorr,source_nickname FROM t2wellsource WHERE  source_nickname NOT LIKE&#39;GEN*&#39; ORDER BY source_nickname;&quot;</span><span class="p">,</span><span class="n">conn</span><span class="p">)</span>

	<span class="n">final_t2</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
	<span class="n">output_fi_file</span><span class="o">=</span><span class="s2">&quot;../model/t2/t2.out&quot;</span>

	<span class="n">dictionary_files</span><span class="o">=</span><span class="p">{}</span>

	<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data_source</span><span class="p">)):</span>
		<span class="n">well</span><span class="o">=</span><span class="n">data_source</span><span class="p">[</span><span class="s1">&#39;well&#39;</span><span class="p">][</span><span class="n">n</span><span class="p">]</span>
		<span class="n">blockcorr</span><span class="o">=</span><span class="n">data_source</span><span class="p">[</span><span class="s1">&#39;blockcorr&#39;</span><span class="p">][</span><span class="n">n</span><span class="p">]</span>
		<span class="n">source</span><span class="o">=</span><span class="n">data_source</span><span class="p">[</span><span class="s1">&#39;source_nickname&#39;</span><span class="p">][</span><span class="n">n</span><span class="p">]</span>
		<span class="n">dictionary_files</span><span class="p">[</span><span class="n">well</span><span class="p">]</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;filename&#39;</span><span class="p">:</span><span class="s2">&quot;../output/mh/txt/</span><span class="si">%s</span><span class="s2">_</span><span class="si">%s</span><span class="s2">_</span><span class="si">%s</span><span class="s2">_evol_mh.dat&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">well</span><span class="p">,</span><span class="n">blockcorr</span><span class="p">,</span><span class="n">source</span><span class="p">),</span><span class="s1">&#39;file_container&#39;</span><span class="p">:</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s1">&#39;blockcorr&#39;</span><span class="p">:</span><span class="n">blockcorr</span><span class="p">,</span><span class="s1">&#39;source&#39;</span><span class="p">:</span><span class="n">source</span><span class="p">}</span>
		<span class="n">dictionary_files</span><span class="p">[</span><span class="n">well</span><span class="p">][</span><span class="s1">&#39;file_container&#39;</span><span class="p">]</span><span class="o">+=</span><span class="s2">&quot;ELEMENT,SOURCEINDEX,GENERATION RATE,ENTHALPY,X1,X2,FF(GAS),FF(AQ.),P(WB),TIME</span><span class="se">\n</span><span class="s2">&quot;</span>

	<span class="n">output_t2_file</span><span class="o">=</span><span class="s2">&quot;../model/t2/t2.out&quot;</span>
	<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">output_t2_file</span><span class="p">):</span>
		<span class="n">t2_file</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">output_t2_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">t2_line</span> <span class="ow">in</span> <span class="n">t2_file</span><span class="p">:</span>
			<span class="k">if</span> <span class="s2">&quot;OUTPUT DATA AFTER&quot;</span> <span class="ow">in</span> <span class="n">t2_line</span><span class="p">:</span>
				<span class="n">time</span><span class="o">=</span><span class="n">t2_line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
			<span class="k">for</span> <span class="n">well</span> <span class="ow">in</span> <span class="n">dictionary_files</span><span class="p">:</span>
				<span class="k">if</span> <span class="n">dictionary_files</span><span class="p">[</span><span class="n">well</span><span class="p">][</span><span class="s1">&#39;blockcorr&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">t2_line</span> <span class="ow">and</span> <span class="n">dictionary_files</span><span class="p">[</span><span class="n">well</span><span class="p">][</span><span class="s1">&#39;source&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">t2_line</span><span class="p">:</span>
					<span class="n">t2_array</span><span class="o">=</span><span class="n">t2_line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
					<span class="n">str_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">t2_array</span><span class="p">))</span>
					<span class="n">str_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
					<span class="n">dictionary_files</span><span class="p">[</span><span class="n">well</span><span class="p">][</span><span class="s1">&#39;file_container&#39;</span><span class="p">]</span><span class="o">+=</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">str_list</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
		<span class="n">t2_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;The file </span><span class="si">%s</span><span class="s2"> or directory do not exist&quot;</span><span class="o">%</span><span class="n">output_t2_file</span><span class="p">)</span>

	<span class="k">for</span> <span class="n">well</span> <span class="ow">in</span> <span class="n">dictionary_files</span><span class="p">:</span>
		<span class="n">t2_file_out</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">dictionary_files</span><span class="p">[</span><span class="n">well</span><span class="p">][</span><span class="s1">&#39;filename&#39;</span><span class="p">],</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
		<span class="n">t2_file_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">dictionary_files</span><span class="p">[</span><span class="n">well</span><span class="p">][</span><span class="s1">&#39;file_container&#39;</span><span class="p">])</span>
		<span class="n">t2_file_out</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>	

	<span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

<div class="viewcode-block" id="write_PT_from_t2output_from_prod"><a class="viewcode-back" href="../modules/output.html#output.write_PT_from_t2output_from_prod">[docs]</a><span class="k">def</span> <span class="nf">write_PT_from_t2output_from_prod</span><span class="p">(</span><span class="n">input_dictionary</span><span class="p">,</span><span class="n">sav_version</span><span class="o">=</span><span class="s1">&#39;sav1&#39;</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;It writes a pressure and temperature comming from block on every well in the specified .sav file.</span>

<span class="sd">	Parameters</span>
<span class="sd">	----------</span>
<span class="sd">	input_dictionary : dictionary</span>
<span class="sd">	 Dictionary contaning the path and name of database on keyword &#39;db_path&#39;.</span>
<span class="sd">	sav_version : str</span>
<span class="sd">	  Extension of sav file, i.e. sav, sav1, sav2, etc.</span>

<span class="sd">	Returns</span>
<span class="sd">	-------</span>
<span class="sd">	file</span>
<span class="sd">	  {well_name}_PT.txt: it contains the pressure and temperature information for every well</span>

<span class="sd">	&quot;&quot;&quot;</span>

	<span class="n">db_path</span><span class="o">=</span><span class="n">input_dictionary</span><span class="p">[</span><span class="s1">&#39;db_path&#39;</span><span class="p">]</span>

	<span class="n">wells</span><span class="o">=</span><span class="p">[]</span>

	<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;WELLS&#39;</span><span class="p">,</span><span class="s1">&#39;MAKE_UP_WELLS&#39;</span><span class="p">,</span><span class="s1">&#39;NOT_PRODUCING_WELL&#39;</span><span class="p">]:</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="k">for</span> <span class="n">well</span> <span class="ow">in</span> <span class="n">input_dictionary</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
				<span class="n">wells</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">well</span><span class="p">)</span>
		<span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
			<span class="k">pass</span>

	<span class="n">conn</span><span class="o">=</span><span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">db_path</span><span class="p">)</span>
	<span class="n">c</span><span class="o">=</span><span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

	<span class="c1">#Listing all the wells and assigning them to a well</span>

	<span class="n">blocks_wells</span><span class="o">=</span><span class="p">{}</span>
	<span class="n">wells_data</span><span class="o">=</span><span class="p">{}</span>
	<span class="n">blocks_dictionary</span><span class="o">=</span><span class="p">{}</span>

	<span class="n">data_layer</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s2">&quot;SELECT correlative FROM layers ORDER BY  middle DESC;&quot;</span><span class="p">,</span><span class="n">conn</span><span class="p">)</span>

	<span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">wells</span><span class="p">):</span>
		<span class="n">wells_data</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
		<span class="n">data_block</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s2">&quot;SELECT blockcorr FROM t2wellblock  WHERE well=&#39;</span><span class="si">%s</span><span class="s2">&#39; ORDER BY blockcorr;&quot;</span><span class="o">%</span><span class="n">name</span><span class="p">,</span><span class="n">conn</span><span class="p">)</span>
		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_block</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
			<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">data_layer</span><span class="p">[</span><span class="s1">&#39;correlative&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
				<span class="n">blocks_wells</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="n">data_block</span><span class="p">[</span><span class="s1">&#39;blockcorr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">=</span><span class="n">name</span>

	
	<span class="n">output_sav_file</span><span class="o">=</span><span class="s2">&quot;../model/t2/t2.</span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">sav_version</span>
	<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">output_sav_file</span><span class="p">):</span>
		<span class="n">t2_sav_file</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">output_sav_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
		<span class="n">contidion_found</span><span class="o">=</span><span class="kc">False</span>
		<span class="k">for</span> <span class="n">t2_sav_line</span> <span class="ow">in</span> <span class="n">t2_sav_file</span><span class="p">:</span>
			<span class="k">if</span>  <span class="n">t2_sav_line</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span> <span class="ow">in</span>  <span class="n">blocks_wells</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
				<span class="n">contidion_found</span><span class="o">=</span><span class="kc">True</span>
				<span class="n">well</span><span class="o">=</span><span class="n">blocks_wells</span><span class="p">[</span><span class="n">t2_sav_line</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">]]</span>
				<span class="n">block</span><span class="o">=</span><span class="n">t2_sav_line</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span>
				<span class="k">continue</span>
			<span class="k">if</span> <span class="n">contidion_found</span><span class="p">:</span>
				<span class="n">wells_data</span><span class="p">[</span><span class="n">well</span><span class="p">]</span><span class="o">+=</span><span class="s2">&quot;</span><span class="si">%s%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">block</span><span class="p">,</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">t2_sav_line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)))</span>
				<span class="n">contidion_found</span><span class="o">=</span><span class="kc">False</span>
		<span class="n">t2_sav_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

	<span class="k">for</span> <span class="n">well</span> <span class="ow">in</span> <span class="n">wells_data</span><span class="p">:</span>
		<span class="n">file_out</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="s2">&quot;../output/PT/txt/</span><span class="si">%s</span><span class="s2">_PT.dat&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">well</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
		<span class="n">file_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;ELEM,P,T</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
		<span class="n">file_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">wells_data</span><span class="p">[</span><span class="n">well</span><span class="p">])</span>
		<span class="n">file_out</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

	<span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

<div class="viewcode-block" id="extract_csv_from_t2out"><a class="viewcode-back" href="../modules/output.html#output.extract_csv_from_t2out">[docs]</a><span class="k">def</span> <span class="nf">extract_csv_from_t2out</span><span class="p">(</span><span class="n">json_output</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;It writes the parameter for every block from the last output file of TOUGH2 simulation on csv or json</span>

<span class="sd">	Parameters</span>
<span class="sd">	----------</span>
<span class="sd">	json_output : bool</span>
<span class="sd">	  If True a json file is save on ../output/PT/json/</span>

<span class="sd">	Returns</span>
<span class="sd">	-------</span>
<span class="sd">	file</span>
<span class="sd">	  PT.csv: on ../output/PT/csv/</span>

<span class="sd">	Attention</span>
<span class="sd">	---------</span>
<span class="sd">	The file ELEME.json needs to be updated</span>
<span class="sd">	&quot;&quot;&quot;</span>
	
	<span class="n">eleme_dict</span><span class="o">=</span><span class="p">{}</span>

	<span class="n">ELEME_file</span><span class="o">=</span><span class="s1">&#39;../mesh/ELEME.json&#39;</span>
	<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">ELEME_file</span><span class="p">):</span>
		<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">ELEME_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
		  	<span class="n">blocks_position</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

		<span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">blocks_position</span><span class="p">:</span>
			<span class="n">eleme_dict</span><span class="p">[</span><span class="n">block</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="n">blocks_position</span><span class="p">[</span><span class="n">block</span><span class="p">][</span><span class="s1">&#39;X&#39;</span><span class="p">],</span><span class="n">blocks_position</span><span class="p">[</span><span class="n">block</span><span class="p">][</span><span class="s1">&#39;Y&#39;</span><span class="p">],</span><span class="n">blocks_position</span><span class="p">[</span><span class="n">block</span><span class="p">][</span><span class="s1">&#39;Z&#39;</span><span class="p">]]</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="k">return</span> <span class="s2">&quot;The file </span><span class="si">%s</span><span class="s2"> does not exist&quot;</span><span class="o">%</span><span class="n">ELEME_file</span>

	<span class="n">last</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
	<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="s2">&quot;../model/t2/t2.out&quot;</span><span class="p">):</span>
		<span class="n">t2file</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="s2">&quot;../model/t2/t2.out&quot;</span><span class="p">,</span><span class="s2">&quot;r&quot;</span><span class="p">)</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="k">return</span> <span class="s2">&quot;Theres is not t2.out file on t2/t2.out&quot;</span>


	<span class="n">cnt</span><span class="o">=</span><span class="mi">0</span>
	<span class="n">t2string</span><span class="o">=</span><span class="p">[]</span>
	<span class="c1">#It finds the last section where OUTPUT DATA AFTER was printed and uses it to know where to start to extract data. But also converts every line of the file into an element in an array</span>
	<span class="k">for</span> <span class="n">linet2</span> <span class="ow">in</span> <span class="n">t2file</span><span class="p">:</span>
		<span class="n">cnt</span><span class="o">+=</span><span class="mi">1</span>
		<span class="n">t2string</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">linet2</span><span class="o">.</span><span class="n">rstrip</span><span class="p">())</span>
		<span class="k">if</span> <span class="s2">&quot;OUTPUT DATA AFTER&quot;</span> <span class="ow">in</span> <span class="n">linet2</span><span class="o">.</span><span class="n">rstrip</span><span class="p">():</span>
			<span class="n">last</span><span class="o">=</span><span class="n">linet2</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
			<span class="n">line</span><span class="o">=</span><span class="n">cnt</span>
	<span class="n">t2file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

	<span class="n">high_iteration</span><span class="o">=</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">last</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()]</span>

	<span class="k">for</span> <span class="n">elementx</span> <span class="ow">in</span> <span class="n">eleme_dict</span><span class="p">:</span>
		<span class="n">cnt2</span><span class="o">=</span><span class="mi">0</span>
		<span class="k">for</span> <span class="n">lineout</span> <span class="ow">in</span> <span class="n">t2string</span><span class="p">[</span><span class="n">line</span><span class="o">+</span><span class="n">cnt2</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
			<span class="k">if</span> <span class="s2">&quot; @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&quot;</span><span class="o">==</span><span class="n">lineout</span><span class="p">:</span>
				<span class="n">cnt2</span><span class="o">+=</span><span class="mi">1</span>
			<span class="k">elif</span> <span class="n">cnt2</span><span class="o">&gt;</span><span class="mi">2</span><span class="p">:</span>
				<span class="k">break</span>
			<span class="k">elif</span> <span class="n">elementx</span> <span class="ow">in</span> <span class="n">lineout</span><span class="p">:</span>
				<span class="n">lineselect</span><span class="o">=</span><span class="n">lineout</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
				<span class="n">eleme_dict</span><span class="p">[</span><span class="n">elementx</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">lineselect</span><span class="p">)</span>
				<span class="k">break</span>

	<span class="n">csv_columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">,</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span><span class="s1">&#39;ELEM&#39;</span><span class="p">,</span><span class="s1">&#39;INDEX&#39;</span><span class="p">,</span><span class="s1">&#39;P&#39;</span><span class="p">,</span><span class="s1">&#39;T&#39;</span><span class="p">,</span><span class="s1">&#39;SG&#39;</span><span class="p">,</span><span class="s1">&#39;SW&#39;</span><span class="p">,</span><span class="s1">&#39;X(WAT1)&#39;</span><span class="p">,</span><span class="s1">&#39;X(WAT2)&#39;</span><span class="p">,</span><span class="s1">&#39;PCAP&#39;</span><span class="p">,</span><span class="s1">&#39;DG&#39;</span><span class="p">,</span><span class="s1">&#39;DW&#39;</span><span class="p">]</span>

	<span class="k">if</span> <span class="n">json_output</span><span class="p">:</span>
		<span class="n">eleme_pd</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">eleme_dict</span><span class="p">,</span><span class="n">orient</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">,</span><span class="n">columns</span><span class="o">=</span><span class="n">csv_columns</span><span class="p">)</span>
		<span class="n">dtype</span><span class="o">=</span> <span class="p">{</span><span class="s1">&#39;X&#39;</span><span class="p">:</span><span class="s1">&#39;float&#39;</span><span class="p">,</span>
				 <span class="s1">&#39;Y&#39;</span><span class="p">:</span><span class="s1">&#39;float&#39;</span><span class="p">,</span>
				 <span class="s1">&#39;Z&#39;</span><span class="p">:</span><span class="s1">&#39;float&#39;</span><span class="p">,</span>
				 <span class="s1">&#39;ELEM&#39;</span><span class="p">:</span><span class="s1">&#39;str&#39;</span><span class="p">,</span>
				 <span class="s1">&#39;INDEX&#39;</span><span class="p">:</span><span class="s1">&#39;float&#39;</span><span class="p">,</span>
				 <span class="s1">&#39;P&#39;</span><span class="p">:</span><span class="s1">&#39;float&#39;</span><span class="p">,</span>
				 <span class="s1">&#39;T&#39;</span><span class="p">:</span><span class="s1">&#39;float&#39;</span><span class="p">,</span>
				 <span class="s1">&#39;SG&#39;</span><span class="p">:</span><span class="s1">&#39;float&#39;</span><span class="p">,</span>
				 <span class="s1">&#39;SW&#39;</span><span class="p">:</span><span class="s1">&#39;float&#39;</span><span class="p">,</span>
				 <span class="s1">&#39;X(WAT1)&#39;</span><span class="p">:</span><span class="s1">&#39;float&#39;</span><span class="p">,</span>
				 <span class="s1">&#39;X(WAT2)&#39;</span><span class="p">:</span><span class="s1">&#39;float&#39;</span><span class="p">,</span>
				 <span class="s1">&#39;PCAP&#39;</span><span class="p">:</span><span class="s1">&#39;float&#39;</span><span class="p">,</span>
				 <span class="s1">&#39;DG&#39;</span><span class="p">:</span><span class="s1">&#39;float&#39;</span><span class="p">,</span>
				 <span class="s1">&#39;DW&#39;</span><span class="p">:</span><span class="s1">&#39;float&#39;</span><span class="p">}</span>
		<span class="n">eleme_pd</span><span class="o">=</span> <span class="n">eleme_pd</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>
		<span class="n">eleme_pd</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="s2">&quot;../output/PT/json/PT_json.txt&quot;</span><span class="p">,</span><span class="n">orient</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">,</span><span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

	<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;../output/PT/csv/PT.csv&quot;</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
		<span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">csv_columns</span><span class="p">))</span>
		<span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">eleme_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
			<span class="n">string</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
			<span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">eleme_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
				<span class="n">string</span><span class="o">+=</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">,&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
			<span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">string</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>
			<span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
	<span class="n">file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

<div class="viewcode-block" id="t2_to_json"><a class="viewcode-back" href="../modules/output.html#output.t2_to_json">[docs]</a><span class="k">def</span> <span class="nf">t2_to_json</span><span class="p">(</span><span class="n">itime</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">save_full</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;It creates a severals or a single json file from the output file from the TOUGH2 run</span>

<span class="sd">	Parameters</span>
<span class="sd">	----------</span>
<span class="sd"> 	itime: float</span>
<span class="sd">	  It defines a time at which a the parameters from the blocks are extracted into json file. Must be on the same units as the TOUGH2 output files (days, seconds, etc.)</span>
<span class="sd">	save_full: bool</span>
<span class="sd">	  If True it creates a single output json file</span>

<span class="sd">	Returns</span>
<span class="sd">	-------</span>
<span class="sd">	files</span>
<span class="sd">	  t2_ouput_{time}.json: on ../output/PT/json/evol/</span>
<span class="sd">	file</span>
<span class="sd">	  t2_output:  on ../output/PT/json/</span>

<span class="sd">	Attention</span>
<span class="sd">	---------</span>
<span class="sd">	When t2_output is saved, the large could be too large for the system to handle it</span>

<span class="sd">	Examples</span>
<span class="sd">	--------</span>
<span class="sd">	&gt;&gt;&gt; t2_to_json()</span>
<span class="sd">	&quot;&quot;&quot;</span>

	<span class="n">block__json_file</span><span class="o">=</span><span class="s1">&#39;../mesh/ELEME.json&#39;</span>

	<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">block__json_file</span><span class="p">):</span>
		<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;../mesh/ELEME.json&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
		  	<span class="n">blocks</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;The file </span><span class="si">%s</span><span class="s2"> or directory do not exist, run ELEM_to_json from regeo_mesh&quot;</span><span class="o">%</span><span class="n">output_t2_file</span><span class="p">)</span>		  	


	<span class="n">parameters</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="s2">&quot;P&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="s2">&quot;T&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">:</span><span class="s2">&quot;SG&quot;</span><span class="p">,</span><span class="mi">3</span><span class="p">:</span><span class="s2">&quot;SW&quot;</span><span class="p">,</span><span class="mi">4</span><span class="p">:</span><span class="s2">&quot;X(WAT1)&quot;</span><span class="p">,</span><span class="mi">5</span><span class="p">:</span><span class="s2">&quot;X(WAT2)&quot;</span><span class="p">,</span><span class="mi">6</span><span class="p">:</span><span class="s2">&quot;PCAP&quot;</span><span class="p">,</span><span class="mi">7</span><span class="p">:</span><span class="s2">&quot;DG&quot;</span><span class="p">,</span><span class="mi">8</span><span class="p">:</span><span class="s2">&quot;DW&quot;</span><span class="p">}</span>

	<span class="c1">#Creates a json file for every output time on the TOUGH2 output file</span>
	<span class="n">cnt</span><span class="o">=</span><span class="mi">0</span>
	<span class="n">output_t2_file</span><span class="o">=</span><span class="s2">&quot;../model/t2/t2.out&quot;</span>
	<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">output_t2_file</span><span class="p">):</span>
		<span class="n">t2_file</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">output_t2_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">t2_line</span> <span class="ow">in</span> <span class="n">t2_file</span><span class="p">:</span>
			<span class="k">if</span> <span class="s2">&quot;OUTPUT DATA AFTER&quot;</span> <span class="ow">in</span> <span class="n">t2_line</span><span class="p">:</span>
				<span class="k">if</span> <span class="n">cnt</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
					<span class="k">if</span> <span class="n">itime</span><span class="o">==</span><span class="kc">None</span> <span class="ow">or</span> <span class="p">(</span><span class="n">itime</span><span class="o">!=</span><span class="kc">None</span> <span class="ow">and</span> <span class="nb">float</span><span class="p">(</span><span class="n">time</span><span class="p">)</span><span class="o">==</span><span class="nb">float</span><span class="p">(</span><span class="n">itime</span><span class="p">)):</span>
						<span class="n">t2_pd</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">data_dictionary</span><span class="p">,</span><span class="n">orient</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">)</span>
						<span class="n">t2_pd</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="s1">&#39;../output/PT/json/evol/t2_output_</span><span class="si">%s</span><span class="s1">.json&#39;</span><span class="o">%</span><span class="n">time</span><span class="p">,</span><span class="n">orient</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">,</span><span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
						<span class="k">if</span> <span class="n">itime</span><span class="o">!=</span><span class="kc">None</span> <span class="ow">and</span> <span class="n">itime</span><span class="o">==</span><span class="nb">float</span><span class="p">(</span><span class="n">itime</span><span class="p">):</span>
							<span class="k">break</span>
				<span class="n">cnt</span><span class="o">+=</span><span class="mi">1</span>
				<span class="n">time</span><span class="o">=</span><span class="n">t2_line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
				<span class="n">data_dictionary</span><span class="o">=</span><span class="p">{}</span>
				<span class="n">data_dictionary</span><span class="p">[</span><span class="n">time</span><span class="p">]</span><span class="o">=</span><span class="p">{}</span>
			<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">t2_line</span><span class="o">.</span><span class="n">split</span><span class="p">())</span><span class="o">==</span><span class="mi">12</span> <span class="ow">and</span> <span class="n">t2_line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">blocks</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
				<span class="n">t2_array</span><span class="o">=</span><span class="n">t2_line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
				<span class="n">data_list</span><span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">t2_array</span><span class="p">))</span>
				<span class="n">data_dictionary</span><span class="p">[</span><span class="n">time</span><span class="p">][</span><span class="n">data_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">=</span><span class="p">{}</span>
				<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">:</span>
					<span class="n">data_dictionary</span><span class="p">[</span><span class="n">time</span><span class="p">][</span><span class="n">data_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">parameters</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">data_list</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">])</span>
		<span class="n">t2_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;The file </span><span class="si">%s</span><span class="s2"> or directory do not exist&quot;</span><span class="o">%</span><span class="n">output_t2_file</span><span class="p">)</span>

	<span class="k">if</span> <span class="n">save_full</span><span class="p">:</span>
		<span class="c1">#It generates a dictionary with time as key and json file output as value</span>
		<span class="n">src</span><span class="o">=</span><span class="s1">&#39;../output/PT/json/evol/&#39;</span>
		<span class="n">src_files</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">src</span><span class="p">)</span>
		<span class="n">files_dictionary</span><span class="o">=</span><span class="p">{}</span>
		<span class="k">for</span> <span class="n">file_name</span> <span class="ow">in</span> <span class="n">src_files</span><span class="p">:</span>
			<span class="n">time</span><span class="o">=</span><span class="n">file_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.j&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
			<span class="n">full_file_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>
			<span class="n">files_dictionary</span><span class="p">[</span><span class="n">time</span><span class="p">]</span><span class="o">=</span><span class="n">full_file_name</span>
	
		<span class="c1">#It generates a single json output file, for a large model it can be to large for the system memory</span>
		<span class="n">t2_json</span><span class="o">=</span><span class="s1">&#39;../output/PT/json/t2_output.json&#39;</span>
		<span class="n">t2_output_file</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">t2_json</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>

		<span class="n">t2_output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;{</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">files_dictionary</span><span class="p">):</span>
			<span class="n">file</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">files_dictionary</span><span class="p">[</span><span class="n">time</span><span class="p">],</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
			<span class="n">lines</span><span class="o">=</span><span class="n">file</span><span class="o">.</span><span class="n">readlines</span><span class="p">()[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
			<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
				<span class="n">t2_output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
			<span class="n">t2_output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;,</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>		
		<span class="n">t2_output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;}&quot;</span><span class="p">)</span>
		<span class="n">t2_output_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

<div class="viewcode-block" id="it2COF"><a class="viewcode-back" href="../modules/output.html#output.it2COF">[docs]</a><span class="k">def</span> <span class="nf">it2COF</span><span class="p">(</span><span class="n">input_dictionary</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;Extracts the COF value for each block on the OBSERVATION section of the inverse file</span>

<span class="sd">	Parameters</span>
<span class="sd">	----------</span>
<span class="sd">	input_dictionary : dictionary</span>
<span class="sd">		Contains the name of the iTOUGH2 file</span>

<span class="sd">	Returns</span>
<span class="sd">	-------</span>
<span class="sd">	file</span>
<span class="sd">		COF_PT.json: on the output/PT/json/ folder</span>

<span class="sd">	Attention</span>
<span class="sd">	---------</span>
<span class="sd">	It might changed based on the iTOUGH2 version</span>

<span class="sd">	Examples</span>
<span class="sd">	--------</span>
<span class="sd">	&gt;&gt;&gt; it2COF(input_dictionary)</span>
<span class="sd">	&quot;&quot;&quot;</span>

	<span class="n">it2_output_file</span><span class="o">=</span><span class="s2">&quot;../model/t2/</span><span class="si">%s</span><span class="s2">.out&quot;</span><span class="o">%</span><span class="n">input_dictionary</span><span class="p">[</span><span class="s1">&#39;iTOUGH2_file&#39;</span><span class="p">]</span>
	<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">it2_output_file</span><span class="p">):</span>
		<span class="k">pass</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="k">return</span> <span class="s2">&quot;Theres is not %.out file on t2/</span><span class="si">%s</span><span class="s2">.out&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">input_dictionary</span><span class="p">[</span><span class="s1">&#39;iTOUGH2_file&#39;</span><span class="p">],</span><span class="n">input_dictionary</span><span class="p">[</span><span class="s1">&#39;iTOUGH2_file&#39;</span><span class="p">])</span>

	<span class="c1">#First and last line in between the data</span>
	<span class="n">compare1</span> <span class="o">=</span> <span class="s2">&quot; DATASET              DATAPOINTS          MEAN       MEDIAN    STD. DEV.    AVE. DEV.   SKEWNESS   KURTOSIS      M/S    DWA     COF&quot;</span>
	<span class="n">compare2</span> <span class="o">=</span> <span class="s2">&quot; - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -&quot;</span>

	<span class="c1">#Empty dataframe</span>
	<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;DATASET&quot;</span><span class="p">,</span><span class="s2">&quot;DATAPOINTS&quot;</span><span class="p">,</span><span class="s2">&quot;MEAN&quot;</span><span class="p">,</span><span class="s2">&quot;MEDIAN&quot;</span><span class="p">,</span><span class="s2">&quot;STD. DEV.&quot;</span><span class="p">,</span><span class="s2">&quot;AVE. DEV.&quot;</span><span class="p">,</span><span class="s2">&quot;SKEWNESS&quot;</span><span class="p">,</span><span class="s2">&quot;KURTOSIS&quot;</span><span class="p">,</span><span class="s2">&quot;M/S&quot;</span><span class="p">,</span><span class="s2">&quot;DWA&quot;</span><span class="p">,</span><span class="s2">&quot;COF&quot;</span><span class="p">])</span>

	<span class="c1">#Extracts the data based on compare1 and compare2</span>
	<span class="n">output_headers</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">it2_output_file</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">t2_file</span><span class="p">:</span>
		<span class="n">it2_output_array</span> <span class="o">=</span> <span class="n">t2_file</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
		<span class="n">save</span> <span class="o">=</span> <span class="kc">False</span>
		<span class="k">for</span> <span class="n">line_i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">it2_output_array</span><span class="p">):</span>

			<span class="k">if</span> <span class="n">compare1</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">():</span>
				<span class="n">save</span> <span class="o">=</span> <span class="kc">True</span>
			<span class="k">elif</span> <span class="n">compare2</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">():</span>
				<span class="n">save</span> <span class="o">=</span> <span class="kc">False</span>

			<span class="k">if</span> <span class="n">save</span><span class="p">:</span>
				<span class="n">output_headers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">it2_output_array</span><span class="p">[</span><span class="n">line_i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>

	<span class="c1">#Stores the date into the appropiate column</span>
	<span class="n">output_headers</span><span class="o">=</span><span class="n">output_headers</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
	<span class="k">for</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">output_headers</span><span class="p">:</span>
		<span class="n">data_i</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
		<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;DATASET&quot;</span><span class="p">:</span><span class="n">data_i</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
							<span class="s2">&quot;DATAPOINTS&quot;</span><span class="p">:</span><span class="n">data_i</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
							<span class="s2">&quot;MEAN&quot;</span><span class="p">:</span><span class="n">data_i</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
							<span class="s2">&quot;MEDIAN&quot;</span><span class="p">:</span><span class="n">data_i</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span>
							<span class="s2">&quot;STD. DEV.&quot;</span><span class="p">:</span><span class="n">data_i</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span>
							<span class="s2">&quot;AVE. DEV.&quot;</span><span class="p">:</span><span class="n">data_i</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span>
							<span class="s2">&quot;SKEWNESS&quot;</span><span class="p">:</span><span class="n">data_i</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span>
							<span class="s2">&quot;KURTOSIS&quot;</span><span class="p">:</span><span class="n">data_i</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span>
							<span class="s2">&quot;M/S&quot;</span><span class="p">:</span><span class="n">data_i</span><span class="p">[</span><span class="mi">9</span><span class="p">],</span>
							<span class="s2">&quot;DWA&quot;</span><span class="p">:</span><span class="n">data_i</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span>
							<span class="s2">&quot;COF&quot;</span><span class="p">:</span><span class="n">data_i</span><span class="p">[</span><span class="mi">12</span><span class="p">]},</span><span class="n">ignore_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>


	<span class="n">data</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="s2">&quot;../output/PT/json/COF_PT.json&quot;</span><span class="p">,</span><span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span></div>

<div class="viewcode-block" id="it2DATASET"><a class="viewcode-back" href="../modules/output.html#output.it2DATASET">[docs]</a><span class="k">def</span> <span class="nf">it2DATASET</span><span class="p">(</span><span class="n">input_dictionary</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;Extracts the OBSERVATION dataset on the the inverse file</span>

<span class="sd">	Parameters</span>
<span class="sd">	----------</span>
<span class="sd">	input_dictionary : dictionary</span>
<span class="sd">		Contains the name of the iTOUGH2 file</span>

<span class="sd">	Returns</span>
<span class="sd">	-------</span>
<span class="sd">	file</span>
<span class="sd">		it2_PT.json: on the output/PT/json/ folder</span>

<span class="sd">	Attention</span>
<span class="sd">	---------</span>
<span class="sd">	It might changed based on the iTOUGH2 version</span>

<span class="sd">	Examples</span>
<span class="sd">	--------</span>
<span class="sd">	&gt;&gt;&gt; it2DATASET(input_dictionary)</span>
<span class="sd">	&quot;&quot;&quot;</span>

	<span class="n">it2_output_file</span><span class="o">=</span><span class="s2">&quot;../model/t2/</span><span class="si">%s</span><span class="s2">.out&quot;</span><span class="o">%</span><span class="n">input_dictionary</span><span class="p">[</span><span class="s1">&#39;iTOUGH2_file&#39;</span><span class="p">]</span>
	<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">it2_output_file</span><span class="p">):</span>
		<span class="k">pass</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="k">return</span> <span class="s2">&quot;Theres is not </span><span class="si">%s</span><span class="s2">.out file on t2/</span><span class="si">%s</span><span class="s2">.out&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">input_dictionary</span><span class="p">[</span><span class="s1">&#39;iTOUGH2_file&#39;</span><span class="p">],</span><span class="n">input_dictionary</span><span class="p">[</span><span class="s1">&#39;iTOUGH2_file&#39;</span><span class="p">])</span>

	<span class="c1">#First and last line in between the data</span>
	<span class="n">compare1</span><span class="o">=</span><span class="s2">&quot;    # OBSERVATION   AT TIME [sec]     MEASURED     COMPUTED     RESIDUAL     WEIGHT C.O.F [%]    STD. DEV.    Yi      Wi    DWi +/-&quot;</span>
	<span class="n">compare2</span><span class="o">=</span><span class="s2">&quot; Residual Plots&quot;</span>
	<span class="n">compare3</span><span class="o">=</span><span class="s2">&quot; ---&quot;</span>

	<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;NUMBER&quot;</span><span class="p">,</span><span class="s2">&quot;OBSERVATION&quot;</span><span class="p">,</span><span class="s2">&quot;TIME&quot;</span><span class="p">,</span><span class="s2">&quot;MEASURED&quot;</span><span class="p">,</span><span class="s2">&quot;COMPUTED&quot;</span><span class="p">,</span><span class="s2">&quot;RESIDUAL&quot;</span><span class="p">,</span><span class="s2">&quot;WEIGHT&quot;</span><span class="p">,</span><span class="s2">&quot;C.O.F&quot;</span><span class="p">,</span><span class="s2">&quot;STD.DEV&quot;</span><span class="p">])</span>


	<span class="c1">#Extracts the data based on compare1 and compare2</span>
	<span class="n">output_headers</span><span class="o">=</span><span class="p">[]</span>
	<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">it2_output_file</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">t2_file</span><span class="p">:</span>
		<span class="n">it2_output_array</span> <span class="o">=</span> <span class="n">t2_file</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
		<span class="n">save</span> <span class="o">=</span> <span class="kc">False</span>
		<span class="k">for</span> <span class="n">line_i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">it2_output_array</span><span class="p">):</span>
			<span class="k">if</span> <span class="n">compare1</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">():</span>
				<span class="n">save</span> <span class="o">=</span> <span class="kc">True</span>
			<span class="k">elif</span> <span class="n">compare2</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span> <span class="ow">or</span> <span class="n">compare3</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">():</span>
				<span class="n">save</span> <span class="o">=</span> <span class="kc">False</span>

			<span class="k">if</span> <span class="n">save</span> <span class="ow">and</span> <span class="s1">&#39;ABS.&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span> <span class="p">:</span>
				<span class="n">output_headers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">it2_output_array</span><span class="p">[</span><span class="n">line_i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>

	<span class="c1">#Stores the date into the corresponding column</span>

	<span class="n">output_headers</span><span class="o">=</span><span class="n">output_headers</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span> <span class="c1">#[::2]</span>

	<span class="k">for</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">output_headers</span><span class="p">:</span>
		<span class="n">data_i</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
		<span class="k">if</span> <span class="s1">&#39;AA&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data_i</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
			<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;NUMBER&quot;</span><span class="p">:</span><span class="n">data_i</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
								<span class="s2">&quot;OBSERVATION&quot;</span><span class="p">:</span><span class="n">data_i</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
								<span class="s2">&quot;TIME&quot;</span><span class="p">:</span><span class="n">data_i</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
								<span class="s2">&quot;MEASURED&quot;</span><span class="p">:</span><span class="n">data_i</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
								<span class="s2">&quot;COMPUTED&quot;</span><span class="p">:</span><span class="n">data_i</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span>
								<span class="s2">&quot;RESIDUAL&quot;</span><span class="p">:</span><span class="n">data_i</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span>
								<span class="s2">&quot;WEIGHT&quot;</span><span class="p">:</span><span class="n">data_i</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span>
								<span class="s2">&quot;C.O.F&quot;</span><span class="p">:</span><span class="n">data_i</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span>
								<span class="s2">&quot;STD&quot;</span><span class="p">:</span><span class="n">data_i</span><span class="p">[</span><span class="mi">8</span><span class="p">]},</span><span class="n">ignore_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

	<span class="n">data</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="s2">&quot;../output/PT/json/it2_PT.json&quot;</span><span class="p">,</span><span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span></div>

<div class="viewcode-block" id="it2OBJF"><a class="viewcode-back" href="../modules/output.html#output.it2OBJF">[docs]</a><span class="k">def</span> <span class="nf">it2OBJF</span><span class="p">(</span><span class="n">input_dictionary</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;Extracts the value of the objective function from the output inverse file and append it with the current time</span>

<span class="sd">	Parameters</span>
<span class="sd">	----------</span>
<span class="sd">	input_dictionary : dictionary</span>
<span class="sd">		Contains the name of the iTOUGH2 file</span>

<span class="sd">	Returns</span>
<span class="sd">	-------</span>
<span class="sd">	file</span>
<span class="sd">		OBJ.json: on the output/PT/json/ folder</span>

<span class="sd">	Attention</span>
<span class="sd">	---------</span>
<span class="sd">	It might changed based on the iTOUGH2 version</span>

<span class="sd">	Examples</span>
<span class="sd">	--------</span>
<span class="sd">	&gt;&gt;&gt; it2OBJF(input_dictionary)</span>
<span class="sd">	&quot;&quot;&quot;</span>


	<span class="n">it2_output_file</span><span class="o">=</span><span class="s2">&quot;../model/t2/</span><span class="si">%s</span><span class="s2">.out&quot;</span><span class="o">%</span><span class="n">input_dictionary</span><span class="p">[</span><span class="s1">&#39;iTOUGH2_file&#39;</span><span class="p">]</span>
	<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">it2_output_file</span><span class="p">):</span>
		<span class="k">pass</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="k">return</span> <span class="s2">&quot;Theres is not </span><span class="si">%s</span><span class="s2">.out file on t2/</span><span class="si">%s</span><span class="s2">.out&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">input_dictionary</span><span class="p">[</span><span class="s1">&#39;iTOUGH2_file&#39;</span><span class="p">],</span><span class="n">input_dictionary</span><span class="p">[</span><span class="s1">&#39;iTOUGH2_file&#39;</span><span class="p">])</span>

	<span class="c1">#First and last line in between the data</span>

	<span class="n">compare1</span> <span class="o">=</span> <span class="s2">&quot;Objective Function&quot;</span>
	<span class="n">compare2</span> <span class="o">=</span> <span class="s2">&quot;==================================================================================================================================&quot;</span>

	<span class="c1">#Extracts the data based on compare1 and compare2</span>
	<span class="n">cnt</span><span class="o">=</span><span class="mi">0</span>
	<span class="n">output_headers</span><span class="o">=</span><span class="p">[]</span>
	<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">it2_output_file</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">t2_file</span><span class="p">:</span>
		<span class="n">it2_output_array</span> <span class="o">=</span> <span class="n">t2_file</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
		<span class="n">save</span> <span class="o">=</span> <span class="kc">False</span>
		<span class="k">for</span> <span class="n">line_i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">it2_output_array</span><span class="p">):</span>

			<span class="k">if</span> <span class="n">compare1</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">():</span>
				<span class="n">cnt</span><span class="o">+=</span><span class="mi">1</span>
				<span class="n">save</span> <span class="o">=</span> <span class="kc">True</span>
			<span class="k">elif</span> <span class="n">compare2</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">():</span>
				<span class="n">save</span> <span class="o">=</span> <span class="kc">False</span>

			<span class="k">if</span> <span class="n">cnt</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">save</span><span class="p">:</span>
				<span class="n">output_headers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">it2_output_array</span><span class="p">[</span><span class="n">line_i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
	
	<span class="n">OBJ_file</span> <span class="o">=</span> <span class="s2">&quot;../output/PT/json/OBJ.json&quot;</span>

	<span class="n">OBJ</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="n">OBJ_file</span><span class="p">)</span>

	<span class="c1">#Add the current time to the file</span>
	<span class="n">OBJ</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">OBJ</span><span class="o">.</span><span class="n">index</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">_%H%M%S&#39;</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">output_headers</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">6</span><span class="p">])]</span>

	<span class="n">OBJ</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="n">OBJ_file</span><span class="p">,</span><span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span></div>

<div class="viewcode-block" id="src_csv"><a class="viewcode-back" href="../modules/output.html#output.src_csv">[docs]</a><span class="k">def</span> <span class="nf">src_csv</span><span class="p">(</span><span class="n">input_dictionary</span><span class="p">,</span> <span class="n">path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">type_source</span> <span class="o">=</span> <span class="s1">&#39;SRC&#39;</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;It generates an output file containing flow and flowing enthalpy for each sources listed in the GENER section in the TOUGH2 input file..</span>
<span class="sd">	   It expects to read the TOUGH2_gener.csv file</span>

<span class="sd">	Parameters</span>
<span class="sd">	----------</span>
<span class="sd">	input_dictionary : dictionary</span>
<span class="sd">		Dictionary contaning the path and name of database on keyword &#39;db_path&#39; and the TOUGH2 file name.</span>
<span class="sd">	path: str</span>
<span class="sd">		In case a the output file is in a different location. Such as a server.</span>
<span class="sd">	type_source: str</span>
<span class="sd">		Either SRC or GEN</span>

<span class="sd">	Returns</span>
<span class="sd">	-------</span>
<span class="sd">	files</span>
<span class="sd">	  {SOURCE}_{BLOCK}_{NICKNAME}.txt : on  ../output/mh/txt for every source</span>
<span class="sd">	&quot;&quot;&quot;</span>

	<span class="n">db_path</span><span class="o">=</span><span class="n">input_dictionary</span><span class="p">[</span><span class="s1">&#39;db_path&#39;</span><span class="p">]</span>
	<span class="n">t2_file_name</span> <span class="o">=</span> <span class="n">input_dictionary</span><span class="p">[</span><span class="s1">&#39;TOUGH2_file&#39;</span><span class="p">]</span>

	<span class="k">if</span> <span class="n">type_source</span> <span class="o">==</span> <span class="s1">&#39;SRC&#39;</span><span class="p">:</span>
		<span class="n">condition</span> <span class="o">=</span> <span class="s2">&quot;NOT LIKE&#39;GEN*&#39;&quot;</span>
	<span class="k">elif</span> <span class="n">type_source</span> <span class="o">==</span> <span class="s1">&#39;GEN&#39;</span><span class="p">:</span>
		<span class="n">condition</span> <span class="o">=</span> <span class="s2">&quot;LIKE&#39;GEN*&#39;&quot;</span>

	<span class="c1">#List the SOURCES elements (feedzones)</span>
	<span class="n">conn</span><span class="o">=</span><span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">db_path</span><span class="p">)</span>
	<span class="n">c</span><span class="o">=</span><span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
	<span class="n">data_source</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s2">&quot;SELECT well,blockcorr,source_nickname FROM t2wellsource WHERE source_nickname </span><span class="si">%s</span><span class="s2"> ORDER BY source_nickname;&quot;</span><span class="o">%</span><span class="n">condition</span><span class="p">,</span><span class="n">conn</span><span class="p">)</span>

	<span class="c1">#It reads the gener.csv output file line by line and store the data from each GEN element</span>
	<span class="n">poss_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;../model/t2/</span><span class="si">%s</span><span class="s2">_gener.csv&quot;</span><span class="o">%</span><span class="n">t2_file_name</span><span class="p">]</span>
	<span class="n">poss_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
	<span class="n">output_t2_file</span> <span class="o">=</span> <span class="kc">None</span> 
	<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">poss_names</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">file</span><span class="p">):</span>
			<span class="n">output_t2_file</span> <span class="o">=</span> <span class="n">file</span>

	<span class="k">if</span> <span class="n">output_t2_file</span> <span class="o">==</span> <span class="kc">None</span> <span class="p">:</span>
		<span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;No output file located&quot;</span><span class="p">)</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="c1">#Initialize a dictionary containing the file path and name.</span>
		<span class="n">dictionary_files</span><span class="o">=</span><span class="p">{}</span>
		<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data_source</span><span class="p">)):</span>
			<span class="n">well</span><span class="o">=</span><span class="n">data_source</span><span class="p">[</span><span class="s1">&#39;well&#39;</span><span class="p">][</span><span class="n">n</span><span class="p">]</span>
			<span class="n">blockcorr</span><span class="o">=</span><span class="n">data_source</span><span class="p">[</span><span class="s1">&#39;blockcorr&#39;</span><span class="p">][</span><span class="n">n</span><span class="p">]</span>
			<span class="n">source</span><span class="o">=</span><span class="n">data_source</span><span class="p">[</span><span class="s1">&#39;source_nickname&#39;</span><span class="p">][</span><span class="n">n</span><span class="p">]</span>
			<span class="n">dictionary_files</span><span class="p">[</span><span class="n">source</span><span class="p">]</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;filename&#39;</span><span class="p">:</span><span class="s2">&quot;../output/mh/txt/</span><span class="si">%s</span><span class="s2">_</span><span class="si">%s</span><span class="s2">_</span><span class="si">%s</span><span class="s2">_evol_mh.dat&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">well</span><span class="p">,</span><span class="n">blockcorr</span><span class="p">,</span><span class="n">source</span><span class="p">),</span><span class="s1">&#39;file_container&#39;</span><span class="p">:</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s1">&#39;blockcorr&#39;</span><span class="p">:</span><span class="n">blockcorr</span><span class="p">,</span><span class="s1">&#39;source&#39;</span><span class="p">:</span><span class="n">source</span><span class="p">}</span>

		<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">output_t2_file</span><span class="p">):</span>
			<span class="n">t2_file</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">output_t2_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
			<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">t2_line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">t2_file</span><span class="p">):</span>
				<span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
					<span class="c1">#Extract the header</span>
					<span class="n">t2_array</span> <span class="o">=</span> <span class="n">t2_line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
					<span class="n">str_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">t2_array</span><span class="p">))</span>
					<span class="n">str_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span>  <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">str_list</span> <span class="k">if</span> <span class="s1">&#39;(&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">val</span> <span class="ow">or</span> <span class="s1">&#39;)&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">val</span><span class="p">]</span>
					<span class="n">str_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">str_list</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="p">]</span>
					<span class="n">str_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;TIME&quot;</span><span class="p">)</span>

					<span class="k">for</span> <span class="n">source</span> <span class="ow">in</span> <span class="n">dictionary_files</span><span class="p">:</span>
						<span class="n">dictionary_files</span><span class="p">[</span><span class="n">source</span><span class="p">][</span><span class="s1">&#39;file_container&#39;</span><span class="p">]</span><span class="o">+=</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">str_list</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

				<span class="k">if</span> <span class="s2">&quot;TIME [sec]&quot;</span> <span class="ow">in</span> <span class="n">t2_line</span><span class="p">:</span>
					<span class="c1">#Extract the time </span>
					<span class="k">try</span><span class="p">:</span>
						<span class="n">time</span> <span class="o">=</span> <span class="n">t2_line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">3</span><span class="p">]</span>
					<span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
						<span class="n">time</span> <span class="o">=</span> <span class="n">t2_line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>


				<span class="k">for</span> <span class="n">source</span> <span class="ow">in</span> <span class="n">dictionary_files</span><span class="p">:</span>
					<span class="c1">#Splits each line from the output file and storage it in a dictionary</span>
					<span class="k">if</span> <span class="n">dictionary_files</span><span class="p">[</span><span class="n">source</span><span class="p">][</span><span class="s1">&#39;blockcorr&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">t2_line</span> <span class="ow">and</span> <span class="n">dictionary_files</span><span class="p">[</span><span class="n">source</span><span class="p">][</span><span class="s1">&#39;source&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">t2_line</span><span class="p">:</span>
						<span class="n">t2_array</span><span class="o">=</span><span class="n">t2_line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
						<span class="n">str_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">t2_array</span><span class="p">))</span>
						<span class="n">str_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">str_list</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="p">]</span>
						<span class="n">str_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">))</span>
						<span class="n">dictionary_files</span><span class="p">[</span><span class="n">source</span><span class="p">][</span><span class="s1">&#39;file_container&#39;</span><span class="p">]</span><span class="o">+=</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">str_list</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
			<span class="n">t2_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;The file </span><span class="si">%s</span><span class="s2"> or directory do not exist&quot;</span><span class="o">%</span><span class="n">output_t2_file</span><span class="p">)</span>


		<span class="c1">#Writes a file for each key word in the dictionary dictionary_files</span>
		<span class="k">for</span> <span class="n">source</span> <span class="ow">in</span> <span class="n">dictionary_files</span><span class="p">:</span>
			<span class="n">t2_file_out</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">dictionary_files</span><span class="p">[</span><span class="n">source</span><span class="p">][</span><span class="s1">&#39;filename&#39;</span><span class="p">],</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
			<span class="n">t2_file_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">dictionary_files</span><span class="p">[</span><span class="n">source</span><span class="p">][</span><span class="s1">&#39;file_container&#39;</span><span class="p">])</span>
			<span class="n">t2_file_out</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>	

	<span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

<div class="viewcode-block" id="eleme_CSV"><a class="viewcode-back" href="../modules/output.html#output.eleme_CSV">[docs]</a><span class="k">def</span> <span class="nf">eleme_CSV</span><span class="p">(</span><span class="n">input_dictionary</span><span class="p">,</span> <span class="n">path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">cutoff_time</span> <span class="o">=</span> <span class="mf">1E50</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;It generates an output file for every element of every well. It is one of the most computationally demanding functions.</span>
<span class="sd">	   It expects to read the output from either TOUGH2_eleme.csv or TOUGH2_XYZ.csv files.</span>

<span class="sd">	Parameters</span>
<span class="sd">	----------</span>
<span class="sd">	input_dictionary : dictionary</span>
<span class="sd">		Dictionary contaning the path and name of database on keyword &#39;db_path&#39; and the TOUGH2 file name.</span>
<span class="sd">	path: str</span>
<span class="sd">		In case a the output file is in a different location. Such as a server.</span>
<span class="sd">	cutoff_time: float</span>
<span class="sd">		Max time to storage</span>

<span class="sd">	Returns</span>
<span class="sd">	-------</span>
<span class="sd">	files</span>
<span class="sd">	  {well}_PT_evol.dat : on  ../output/PT/evol for every well</span>
<span class="sd">	&quot;&quot;&quot;</span>

	<span class="n">db_path</span><span class="o">=</span><span class="n">input_dictionary</span><span class="p">[</span><span class="s1">&#39;db_path&#39;</span><span class="p">]</span>
	<span class="n">t2_file_name</span> <span class="o">=</span> <span class="n">input_dictionary</span><span class="p">[</span><span class="s1">&#39;TOUGH2_file&#39;</span><span class="p">]</span>

	<span class="c1">#List the blocks from each well and file location in the dictionary dictionary_files</span>
	<span class="n">conn</span><span class="o">=</span><span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">db_path</span><span class="p">)</span>
	<span class="n">c</span><span class="o">=</span><span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
	<span class="n">dictionary_files</span> <span class="o">=</span> <span class="p">{}</span>
	<span class="n">data_block</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s2">&quot;SELECT well, blockcorr FROM t2wellblock  ORDER BY blockcorr;&quot;</span><span class="p">,</span><span class="n">conn</span><span class="p">)</span>
	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_block</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
		<span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">blockcorr</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data_block</span><span class="p">[</span><span class="s1">&#39;blockcorr&#39;</span><span class="p">]):</span>
			<span class="n">dictionary_files</span><span class="p">[</span><span class="n">data_block</span><span class="p">[</span><span class="s1">&#39;well&#39;</span><span class="p">][</span><span class="n">n</span><span class="p">]]</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;filename&#39;</span><span class="p">:</span><span class="s2">&quot;../output/PT/evol/</span><span class="si">%s</span><span class="s2">_PT_evol.dat&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">data_block</span><span class="p">[</span><span class="s1">&#39;well&#39;</span><span class="p">][</span><span class="n">n</span><span class="p">]),</span>\
			                                                    <span class="s1">&#39;file_container&#39;</span><span class="p">:</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s1">&#39;blockcorr&#39;</span><span class="p">:</span><span class="n">blockcorr</span><span class="p">}</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;Store data on the table t2wellblock&quot;</span><span class="p">)</span>
	<span class="n">blocks</span> <span class="o">=</span>  <span class="n">data_block</span><span class="p">[</span><span class="s1">&#39;blockcorr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>


	<span class="c1">#It select the correct output file</span>
	<span class="n">poss_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;../model/t2/</span><span class="si">%s</span><span class="s2">_XYZ.csv&quot;</span><span class="o">%</span><span class="n">t2_file_name</span><span class="p">,</span> <span class="s2">&quot;../model/t2/</span><span class="si">%s</span><span class="s2">_eleme.csv&quot;</span><span class="o">%</span><span class="n">t2_file_name</span><span class="p">]</span>
	<span class="n">poss_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
	<span class="n">output_t2_file</span> <span class="o">=</span> <span class="kc">None</span> 
	<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">poss_names</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">file</span><span class="p">):</span>
			<span class="n">output_t2_file</span> <span class="o">=</span> <span class="n">file</span>

	<span class="c1">#It goes line by line extracting the information and storaging it on the right location at the dictionary_files dictionary</span>
	<span class="k">if</span> <span class="n">output_t2_file</span> <span class="o">==</span> <span class="kc">None</span> <span class="p">:</span>
		<span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;No output file located&quot;</span><span class="p">)</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">t2_file</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">output_t2_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">t2_line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">t2_file</span><span class="p">):</span>
			<span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
				<span class="n">t2_array</span><span class="o">=</span><span class="n">t2_line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
				<span class="n">str_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">t2_array</span><span class="p">))</span>
				<span class="n">str_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span>  <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">str_list</span> <span class="k">if</span> <span class="s1">&#39;(&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">val</span> <span class="ow">or</span> <span class="s1">&#39;)&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">val</span><span class="p">]</span>
				<span class="n">str_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">str_list</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="p">]</span>
				<span class="n">str_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;TIME&quot;</span><span class="p">)</span>
				<span class="k">for</span> <span class="n">well</span> <span class="ow">in</span> <span class="n">dictionary_files</span><span class="p">:</span>
					<span class="n">dictionary_files</span><span class="p">[</span><span class="n">well</span><span class="p">][</span><span class="s1">&#39;file_container&#39;</span><span class="p">]</span><span class="o">+=</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">str_list</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
			<span class="k">if</span> <span class="s2">&quot;TIME [sec]&quot;</span> <span class="ow">in</span> <span class="n">t2_line</span><span class="p">:</span>
				<span class="k">try</span><span class="p">:</span>
					<span class="n">time</span> <span class="o">=</span> <span class="n">t2_line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
				<span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
					<span class="n">time</span> <span class="o">=</span> <span class="n">t2_line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

			<span class="n">list_bool</span> <span class="o">=</span> <span class="p">[</span><span class="n">block</span> <span class="ow">in</span> <span class="n">t2_line</span> <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">blocks</span><span class="p">]</span>
			<span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">list_bool</span><span class="p">):</span>
				<span class="n">t2_array</span><span class="o">=</span><span class="n">t2_line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
				<span class="n">str_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">t2_array</span><span class="p">))</span>
				<span class="n">str_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">str_list</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="p">]</span>
				<span class="n">str_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">))</span>
				<span class="n">pos</span> <span class="o">=</span> <span class="n">list_bool</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
				<span class="n">well</span> <span class="o">=</span> <span class="n">data_block</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data_block</span><span class="p">[</span><span class="s1">&#39;blockcorr&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">blocks</span><span class="p">[</span><span class="n">pos</span><span class="p">],</span><span class="s1">&#39;well&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
				<span class="n">dictionary_files</span><span class="p">[</span><span class="n">well</span><span class="p">][</span><span class="s1">&#39;file_container&#39;</span><span class="p">]</span><span class="o">+=</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">str_list</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

			<span class="k">if</span> <span class="n">i</span><span class="o">&gt;</span><span class="mi">10</span> <span class="ow">and</span> <span class="nb">float</span><span class="p">(</span><span class="n">time</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">cutoff_time</span><span class="p">:</span>
				<span class="k">break</span>

		<span class="n">t2_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

	<span class="c1">#Creates a file for every well</span>
	<span class="k">for</span> <span class="n">well</span> <span class="ow">in</span> <span class="n">dictionary_files</span><span class="p">:</span>
		<span class="n">t2_file_out</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">dictionary_files</span><span class="p">[</span><span class="n">well</span><span class="p">][</span><span class="s1">&#39;filename&#39;</span><span class="p">],</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
		<span class="n">t2_file_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">dictionary_files</span><span class="p">[</span><span class="n">well</span><span class="p">][</span><span class="s1">&#39;file_container&#39;</span><span class="p">])</span>
		<span class="n">t2_file_out</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>	

	<span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

<div class="viewcode-block" id="t2_CSV_to_json"><a class="viewcode-back" href="../modules/output.html#output.t2_CSV_to_json">[docs]</a><span class="k">def</span> <span class="nf">t2_CSV_to_json</span><span class="p">(</span><span class="n">input_dictionary</span><span class="p">,</span> <span class="n">itime</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">all_times</span> <span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">num</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">output_times</span> <span class="o">=</span> <span class="mi">220</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;It creates severals or a single json file from the output file from the TOUGH2 run. Each of them for diffent output times.</span>
<span class="sd">	   It expects to read the output from either TOUGH2_eleme.csv or TOUGH2_XYZ.csv files.</span>

<span class="sd">	Parameters</span>
<span class="sd">	----------</span>
<span class="sd"> 	itime: float</span>
<span class="sd">	  It defines a time at which a the parameters from the blocks are extracted into json file. Must be on the same units as the TOUGH2 output files (days, seconds, etc.)</span>
<span class="sd">	path: str</span>
<span class="sd">		In case a the output file is in a different location. Such as a server.</span>
<span class="sd">	input_dictionary : dictionary</span>
<span class="sd">		Dictionary contaning the TOUGH2 file name.</span>
<span class="sd">	all_times: bool</span>
<span class="sd">		If True it saves all the output times (It does not consider itime). If False, it considers itime.</span>
<span class="sd">	output_times: int</span>
<span class="sd">		It is an stimation of the number of output times in the TOUGH2 file. Due to its large runtime it has not been implemented, in Linux the command: grep &#39;TIMES&#39; {T2_output_file.csv} | wl -c, would give the right number</span>
<span class="sd">	num: int</span>
<span class="sd">		Based on a linear spacing it gives the number of output_times that would be store. If None it will store every output time.</span>

<span class="sd">	Returns</span>
<span class="sd">	-------</span>
<span class="sd">	files</span>
<span class="sd">	  t2_ouput_{time}.json: on ../output/PT/json/evol/</span>

<span class="sd">	Attention</span>
<span class="sd">	---------</span>
<span class="sd">	When t2_output is saved, the large could be too large for the system to handle it. The file mesh/ELEME.json has to be created</span>
<span class="sd">	&quot;&quot;&quot;</span>

	<span class="n">t2_file_name</span> <span class="o">=</span> <span class="n">input_dictionary</span><span class="p">[</span><span class="s1">&#39;TOUGH2_file&#39;</span><span class="p">]</span>

	<span class="n">block_json_file</span><span class="o">=</span><span class="s1">&#39;../mesh/ELEME.json&#39;</span>

	<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">block_json_file</span><span class="p">):</span>
		<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;../mesh/ELEME.json&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
		  	<span class="n">blocks</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;The file </span><span class="si">%s</span><span class="s2"> or directory do not exist, run ELEM_to_json from regeo_mesh&quot;</span><span class="o">%</span><span class="n">output_t2_file</span><span class="p">)</span>		  	

	<span class="c1">#It select the correct output file</span>
	<span class="n">poss_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;../model/t2/</span><span class="si">%s</span><span class="s2">_XYZ.csv&quot;</span><span class="o">%</span><span class="n">t2_file_name</span><span class="p">,</span> <span class="s2">&quot;../model/t2/</span><span class="si">%s</span><span class="s2">_eleme.csv&quot;</span><span class="o">%</span><span class="n">t2_file_name</span><span class="p">]</span>
	<span class="n">poss_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
	<span class="n">output_t2_file</span> <span class="o">=</span> <span class="kc">None</span> 
	<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">poss_names</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">file</span><span class="p">):</span>
			<span class="n">output_t2_file</span> <span class="o">=</span> <span class="n">file</span>

	<span class="k">if</span> <span class="n">output_t2_file</span> <span class="o">==</span> <span class="kc">None</span> <span class="p">:</span>
		<span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;No output file located&quot;</span><span class="p">)</span>
	<span class="k">else</span><span class="p">:</span>
		
		<span class="n">cnt_t</span> <span class="o">=</span> <span class="mi">0</span>

		<span class="k">if</span> <span class="n">num</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">positions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">output_times</span><span class="p">,</span> <span class="n">num</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">positions</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">output_times</span><span class="p">)</span>

		<span class="n">t2_file</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">output_t2_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">t2_line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">t2_file</span><span class="p">):</span>

			<span class="c1">#Extract the headers</span>
			<span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
				<span class="n">t2_array</span><span class="o">=</span><span class="n">t2_line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
				<span class="n">param_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">t2_array</span><span class="p">))</span>
				<span class="n">param_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span>  <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">param_list</span> <span class="k">if</span> <span class="s1">&#39;(&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">val</span> <span class="ow">or</span> <span class="s1">&#39;)&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">val</span><span class="p">]</span>
				<span class="n">param_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">param_list</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="p">]</span>

			<span class="c1">#Extracts the time, save the data into json and breaks the function once the time is larger than specified itime</span>
			<span class="k">if</span> <span class="s2">&quot;TIME [sec]&quot;</span> <span class="ow">in</span> <span class="n">t2_line</span><span class="p">:</span>
				<span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span><span class="mi">10</span> <span class="ow">and</span> <span class="n">cnt_t</span> <span class="ow">in</span> <span class="n">positions</span><span class="p">:</span> <span class="c1">#takes the previous time and save it</span>
					<span class="n">t2_pd</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">data_dictionary</span><span class="p">,</span><span class="n">orient</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">)</span>
					<span class="nb">print</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
					<span class="n">t2_pd</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="s1">&#39;../output/PT/json/evol/t2_output_</span><span class="si">%.0f</span><span class="s1">.json&#39;</span><span class="o">%</span><span class="nb">float</span><span class="p">(</span><span class="n">time</span><span class="p">),</span><span class="n">orient</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">,</span><span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
				
				<span class="k">try</span><span class="p">:</span>
					<span class="n">time</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">t2_line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">))</span>
					<span class="n">cnt_t</span> <span class="o">+=</span> <span class="mi">1</span>
				<span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
					<span class="n">time</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">t2_line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">))</span>
					<span class="n">cnt_t</span> <span class="o">+=</span> <span class="mi">1</span>

				<span class="n">data_dictionary</span><span class="o">=</span> <span class="p">{}</span>	
				<span class="n">data_dictionary</span><span class="p">[</span><span class="n">time</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

				<span class="k">if</span> <span class="ow">not</span> <span class="n">all_times</span><span class="p">:</span>
					<span class="k">if</span> <span class="n">time</span> <span class="o">&gt;</span> <span class="n">itime</span><span class="p">:</span>
						<span class="k">break</span>

			<span class="c1">#It stores every line into a dictionary, skips the first line and save just the ones listed into the array positions</span>
			<span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="s1">&#39;TIME&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">t2_line</span> <span class="ow">and</span> <span class="n">cnt_t</span> <span class="ow">in</span> <span class="n">positions</span><span class="p">:</span>
				<span class="n">t2_array</span><span class="o">=</span><span class="n">t2_line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
				<span class="n">str_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">t2_array</span><span class="p">))</span>
				<span class="n">block</span> <span class="o">=</span> <span class="n">str_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

				<span class="n">data_dictionary</span><span class="p">[</span><span class="n">time</span><span class="p">][</span><span class="n">block</span><span class="p">]</span><span class="o">=</span><span class="p">{}</span>
				<span class="n">str_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">str_list</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="p">]</span>
				<span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">param</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">param_list</span><span class="p">):</span>
					<span class="k">try</span><span class="p">:</span>
						<span class="n">data_dictionary</span><span class="p">[</span><span class="n">time</span><span class="p">][</span><span class="n">block</span><span class="p">][</span><span class="n">param</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">str_list</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>
					<span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
						<span class="n">data_dictionary</span><span class="p">[</span><span class="n">time</span><span class="p">][</span><span class="n">block</span><span class="p">][</span><span class="n">param</span><span class="p">]</span> <span class="o">=</span> <span class="n">str_list</span><span class="p">[</span><span class="n">n</span><span class="p">]</span></div>

<div class="viewcode-block" id="total_enthalpy"><a class="viewcode-back" href="../modules/output.html#output.total_enthalpy">[docs]</a><span class="k">def</span> <span class="nf">total_enthalpy</span><span class="p">(</span><span class="n">wells</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;It creates an output file containing the weighted flowing enthalpy from the producing wells.</span>

<span class="sd">	Parameters</span>
<span class="sd">	----------</span>
<span class="sd"> 	wells: list</span>
<span class="sd">	  Contains the producer wells included in the calculation.</span>

<span class="sd">	Returns</span>
<span class="sd">	-------</span>
<span class="sd">	files</span>
<span class="sd">	  total_prod_mh.csv: in input/mh/</span>

<span class="sd">	Attention</span>
<span class="sd">	---------</span>
<span class="sd">	Each file has to be previously storage. It does a forward fill, since it is necessary to have one value at least per day for every well.</span>
<span class="sd">	&quot;&quot;&quot;</span>

	<span class="c1">#Generates empty dataframe</span>
	<span class="n">data_p</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;date_time&#39;</span><span class="p">,</span> <span class="s1">&#39;mh&#39;</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">])</span>
	
	<span class="k">for</span> <span class="n">well</span> <span class="ow">in</span> <span class="n">wells</span><span class="p">:</span>

		<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;date_time&#39;</span><span class="p">,</span> <span class="s1">&#39;mh&#39;</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">])</span>
		
		<span class="c1">#Reads the input file</span>
		<span class="n">data_x</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;../input/mh/</span><span class="si">%s</span><span class="s2">_mh.dat&quot;</span><span class="o">%</span><span class="n">well</span><span class="p">,</span> <span class="n">usecols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;date_time&#39;</span><span class="p">,</span> <span class="s1">&#39;total_flow&#39;</span><span class="p">,</span> <span class="s1">&#39;enthalpy&#39;</span><span class="p">,</span> <span class="s1">&#39;status&#39;</span><span class="p">,</span> <span class="s1">&#39;steam&#39;</span><span class="p">])</span>
		<span class="c1">#To make sure it does not uses periods of time the well was under injection, it considers just steam flow above zero</span>
		<span class="n">data_x</span> <span class="o">=</span> <span class="n">data_x</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data_x</span><span class="p">[</span><span class="s1">&#39;steam&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
		<span class="n">data_x</span><span class="p">[</span><span class="s1">&#39;date_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">data_x</span><span class="p">[</span><span class="s1">&#39;date_time&#39;</span><span class="p">]</span> <span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">_%H:%M:%S&quot;</span><span class="p">)</span>

		<span class="c1">#It does the forward filling</span>
		<span class="n">data_ix</span> <span class="o">=</span> <span class="n">data_x</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
		<span class="n">data_ix</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">data_ix</span><span class="p">[</span><span class="s1">&#39;date_time&#39;</span><span class="p">]</span>
		<span class="k">del</span> <span class="n">data_ix</span><span class="p">[</span><span class="s1">&#39;date_time&#39;</span><span class="p">]</span>
		<span class="n">data_ii_inter_x</span> <span class="o">=</span> <span class="n">data_ix</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">ffill</span><span class="p">()</span>
		<span class="n">data_ii_inter_x</span><span class="p">[</span><span class="s1">&#39;date_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_ii_inter_x</span><span class="o">.</span><span class="n">index</span>

		<span class="c1">#Stores the product of mass flow rate and enthalpy for each well</span>
		<span class="k">if</span> <span class="n">wells</span><span class="p">[</span><span class="n">well</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;producer&#39;</span><span class="p">:</span>
			<span class="n">data</span><span class="p">[</span><span class="s1">&#39;mh&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_ii_inter_x</span><span class="p">[</span><span class="s1">&#39;total_flow&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">data_ii_inter_x</span><span class="p">[</span><span class="s1">&#39;enthalpy&#39;</span><span class="p">]</span>
			<span class="n">data</span><span class="p">[</span><span class="s1">&#39;m&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_ii_inter_x</span><span class="p">[</span><span class="s1">&#39;total_flow&#39;</span><span class="p">]</span>
			<span class="n">data</span><span class="p">[</span><span class="s1">&#39;date_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_ii_inter_x</span><span class="p">[</span><span class="s1">&#39;date_time&#39;</span><span class="p">]</span>
			<span class="n">data_p</span> <span class="o">=</span> <span class="n">data_p</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">ignore_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

	<span class="c1">#Group whole datafrime by date_time</span>
	<span class="n">data_p</span> <span class="o">=</span> <span class="n">data_p</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;date_time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
	<span class="c1">#Calculates the weighted enthalpy</span>
	<span class="n">data_p</span><span class="p">[</span><span class="s1">&#39;h&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_p</span><span class="p">[</span><span class="s1">&#39;mh&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">data_p</span><span class="p">[</span><span class="s1">&#39;m&#39;</span><span class="p">]</span>

	<span class="n">data_p</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;../input/mh/total_prod_mh.csv&#39;</span> <span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="power_i"><a class="viewcode-back" href="../modules/output.html#output.power_i">[docs]</a><span class="k">def</span> <span class="nf">power_i</span><span class="p">(</span><span class="n">Px</span><span class="p">,</span><span class="n">hx</span><span class="p">,</span><span class="n">mx</span><span class="p">,</span><span class="n">ESC</span><span class="p">,</span> <span class="n">atm_p</span> <span class="o">=</span> <span class="mf">0.092</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;It calculates an stimated power output and steam saturation, based on a isoenthalpic expansion</span>

<span class="sd">	Parameters</span>
<span class="sd">	----------</span>
<span class="sd"> 	Px: float</span>
<span class="sd">	  Assumed wellhead pressure</span>
<span class="sd"> 	hx: float</span>
<span class="sd">	  Flowing enthalpy pressure</span>
<span class="sd"> 	mx: float</span>
<span class="sd">	  Mass flow rate</span>
<span class="sd">	ESC: float</span>
<span class="sd">	  Assumed specific steam consumption</span>
<span class="sd">	atm_p: float</span>
<span class="sd">	  Atmosphere presure in bar</span>

<span class="sd">	Returns</span>
<span class="sd">	-------</span>
<span class="sd">	array</span>
<span class="sd">	  [power, saturation]</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">if</span> <span class="n">mx</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">quality</span> <span class="o">=</span> <span class="n">IAPWS97</span><span class="p">(</span><span class="n">P</span><span class="o">=</span><span class="n">Px</span><span class="o">+</span><span class="n">atm_p</span><span class="p">,</span><span class="n">h</span><span class="o">=</span><span class="n">hx</span><span class="p">)</span><span class="o">.</span><span class="n">x</span>
			<span class="n">power</span> <span class="o">=</span> <span class="o">-</span><span class="n">quality</span><span class="o">*</span><span class="n">mx</span><span class="o">/</span><span class="n">ESC</span>
		<span class="k">except</span> <span class="ne">NotImplementedError</span><span class="p">:</span>
			<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Out of bounds, Pressure:&quot;</span><span class="p">,</span> <span class="n">Px</span><span class="p">,</span><span class="s2">&quot;[bar], Enthalpy: &quot;</span><span class="p">,</span><span class="n">hx</span><span class="p">,</span> <span class="s2">&quot;[kJ/kg]&quot;</span><span class="p">)</span>
			<span class="n">power</span> <span class="o">=</span> <span class="mi">0</span>
			<span class="n">quality</span> <span class="o">=</span> <span class="mi">0</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">power</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="n">quality</span> <span class="o">=</span> <span class="mi">0</span>
	<span class="k">return</span> <span class="p">[</span><span class="n">power</span><span class="p">,</span> <span class="n">quality</span><span class="p">]</span></div>

<div class="viewcode-block" id="power"><a class="viewcode-back" href="../modules/output.html#output.power">[docs]</a><span class="k">def</span> <span class="nf">power</span><span class="p">(</span><span class="n">input_dictionary</span><span class="p">,</span> <span class="n">WHP</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;When all the well feedzones are declare as MASS type in the TOUGH2 input file, this functions estimates the power generation based on the assumption of an isoenthalpic expansion from the feedzone to the wellhead.</span>

<span class="sd">	Parameters</span>
<span class="sd">	----------</span>
<span class="sd"> 	input_dictionary: dictionary</span>
<span class="sd">	  Dictionary contaning the path and name of database on keyword &#39;db_path&#39;</span>
<span class="sd"> 	WHP: dictionary</span>
<span class="sd"> 	  Using the structure: &#39;well&#39;:[WHP, ESC, &#39;unit&#39;, &#39;masstype&#39;]. masstype could be either MASS or FLOWELL</span>

<span class="sd">	Returns</span>
<span class="sd">	-------</span>
<span class="sd">	File</span>
<span class="sd">	  units_power.csv: in output/</span>
<span class="sd">	&quot;&quot;&quot;</span>

	<span class="n">conn</span><span class="o">=</span><span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">input_dictionary</span><span class="p">[</span><span class="s1">&#39;db_path&#39;</span><span class="p">])</span>

	<span class="c1">#Creating empty dataframes to store power</span>
	<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;date_time&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">,</span><span class="s1">&#39;BWP&#39;</span><span class="p">,</span> <span class="s1">&#39;power&#39;</span><span class="p">,</span><span class="s1">&#39;unit&#39;</span><span class="p">])</span>
	
	<span class="n">c</span><span class="o">=</span><span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

	<span class="n">well_sources</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM t2wellsource WHERE well LIKE &#39;TR-%&#39;&quot;</span><span class="p">,</span><span class="n">conn</span><span class="p">)</span>

	<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">well_sources</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span> 
		<span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;well&#39;</span><span class="p">])</span> <span class="ow">in</span> <span class="p">[</span><span class="o">*</span><span class="n">WHP</span><span class="p">]:</span>

			<span class="n">evol_file</span> <span class="o">=</span> <span class="s1">&#39;../output/PT/evol/</span><span class="si">%s</span><span class="s1">_PT_evol.dat&#39;</span><span class="o">%</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;well&#39;</span><span class="p">]</span>

			<span class="n">data_i</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">evol_file</span><span class="p">)</span>

			<span class="n">temp_i</span> <span class="o">=</span> <span class="n">data_i</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span> <span class="p">(</span><span class="n">data_i</span><span class="p">[</span><span class="s1">&#39;ELEM&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span> <span class="p">[</span><span class="s1">&#39;blockcorr&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">data_i</span><span class="p">[</span><span class="s1">&#39;TIME&#39;</span><span class="p">]</span> <span class="o">&gt;=</span><span class="mi">0</span> <span class="p">),</span> <span class="p">[</span><span class="s1">&#39;PRES_VAP&#39;</span><span class="p">,</span><span class="s1">&#39;TIME&#39;</span><span class="p">]]</span>
			<span class="n">temp_i</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

			<span class="n">file</span> <span class="o">=</span> <span class="s2">&quot;../output/mh/txt/</span><span class="si">%s</span><span class="s2">_</span><span class="si">%s</span><span class="s2">_</span><span class="si">%s</span><span class="s2">_evol_mh.dat&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;well&#39;</span><span class="p">],</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;blockcorr&#39;</span><span class="p">],</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;source_nickname&#39;</span><span class="p">])</span>

			<span class="n">data_mh</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

			<span class="n">times</span> <span class="o">=</span> <span class="n">data_mh</span><span class="p">[</span><span class="s1">&#39;TIME&#39;</span><span class="p">]</span>

			<span class="n">dates</span><span class="o">=</span><span class="p">[]</span>
			<span class="n">enthalpy</span> <span class="o">=</span> <span class="p">[]</span>
			<span class="n">flow_rate</span> <span class="o">=</span> <span class="p">[]</span>
			<span class="n">pressures</span> <span class="o">=</span> <span class="p">[]</span>
			<span class="n">power</span> <span class="o">=</span> <span class="p">[]</span>
			<span class="n">units</span> <span class="o">=</span> <span class="p">[]</span>

			<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">times</span><span class="p">)):</span>
				<span class="k">if</span> <span class="nb">float</span><span class="p">(</span><span class="n">times</span><span class="p">[</span><span class="n">n</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
					<span class="k">try</span><span class="p">:</span>
						<span class="n">pressures</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp_i</span><span class="p">[</span><span class="s1">&#39;PRES_VAP&#39;</span><span class="p">][</span><span class="n">n</span><span class="p">])</span>
						<span class="n">enthalpy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data_mh</span><span class="p">[</span><span class="s1">&#39;ENTH&#39;</span><span class="p">][</span><span class="n">n</span><span class="p">]</span><span class="o">/</span><span class="mf">1E3</span><span class="p">)</span>
						<span class="n">flow_rate</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data_mh</span><span class="p">[</span><span class="s1">&#39;GEN&#39;</span><span class="p">][</span><span class="n">n</span><span class="p">])</span>
						<span class="n">dates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">input_dictionary</span><span class="p">[</span><span class="s1">&#39;ref_date&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">times</span><span class="p">[</span><span class="n">n</span><span class="p">])))</span>
						<span class="n">units</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">WHP</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;well&#39;</span><span class="p">]][</span><span class="mi">2</span><span class="p">])</span>
						
						<span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;well&#39;</span><span class="p">])</span> <span class="ow">in</span> <span class="p">[</span><span class="o">*</span><span class="n">WHP</span><span class="p">]:</span>
							<span class="n">power</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">power_i</span><span class="p">(</span><span class="n">WHP</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;well&#39;</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mf">1E6</span><span class="p">,</span><span class="n">data_mh</span><span class="p">[</span><span class="s1">&#39;ENTH&#39;</span><span class="p">][</span><span class="n">n</span><span class="p">]</span><span class="o">/</span><span class="mf">1E3</span><span class="p">,</span><span class="n">data_mh</span><span class="p">[</span><span class="s1">&#39;GEN&#39;</span><span class="p">][</span><span class="n">n</span><span class="p">],</span><span class="n">WHP</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;well&#39;</span><span class="p">]][</span><span class="mi">1</span><span class="p">])[</span><span class="mi">0</span><span class="p">])</span>
						<span class="k">else</span><span class="p">:</span>
							<span class="n">power</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>

					<span class="k">except</span> <span class="p">(</span><span class="ne">OverflowError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">):</span>
						<span class="nb">print</span><span class="p">(</span><span class="n">times</span><span class="p">[</span><span class="n">n</span><span class="p">],</span><span class="s2">&quot;plus&quot;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">times</span><span class="p">[</span><span class="n">n</span><span class="p">]),</span><span class="s2">&quot;wont be plot&quot;</span><span class="p">)</span>

			<span class="n">input_row</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;date_time&#39;</span><span class="p">:</span> <span class="n">dates</span><span class="p">,</span>
			                 <span class="s1">&#39;h&#39;</span><span class="p">:</span> <span class="n">enthalpy</span><span class="p">,</span>
			                 <span class="s1">&#39;m&#39;</span><span class="p">:</span> <span class="n">flow_rate</span><span class="p">,</span>
			               <span class="s1">&#39;BWP&#39;</span><span class="p">:</span> <span class="n">pressures</span><span class="p">,</span>
			               <span class="s1">&#39;unit&#39;</span><span class="p">:</span> <span class="n">units</span><span class="p">,</span>
			               <span class="s1">&#39;power&#39;</span><span class="p">:</span><span class="n">power</span><span class="p">}</span>

			<span class="n">output</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">input_row</span><span class="p">)</span>

			<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">ignore_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>


	<span class="n">data_out</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;date_time&#39;</span><span class="p">,</span><span class="s1">&#39;unit&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
	<span class="n">data_out</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;../output/units_power.csv&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="flowell"><a class="viewcode-back" href="../modules/output.html#output.flowell">[docs]</a><span class="k">def</span> <span class="nf">flowell</span><span class="p">(</span><span class="n">input_dictionary</span><span class="p">,</span> <span class="n">init_values</span> <span class="o">=</span> <span class="mi">100000</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;It extracts from the conventional TOUGH2 output file the FLOWELL data for every well.</span>

<span class="sd">	Parameters</span>
<span class="sd">	----------</span>
<span class="sd"> 	input_dictionary: dictionary</span>
<span class="sd">	  Dictionary contaning the path and name of database on keyword &#39;db_path&#39;, the specified layers and the reference date</span>
<span class="sd"> 	init_values: int</span>
<span class="sd"> 	  Number of possible number initial values for FLOWELL output.</span>

<span class="sd">	Returns</span>
<span class="sd">	-------</span>
<span class="sd">	File</span>
<span class="sd">	  flowell.json: at output/</span>
<span class="sd">	&quot;&quot;&quot;</span>

	<span class="n">db_path</span><span class="o">=</span><span class="n">input_dictionary</span><span class="p">[</span><span class="s1">&#39;db_path&#39;</span><span class="p">]</span>
	<span class="n">t2_file_name</span> <span class="o">=</span> <span class="n">input_dictionary</span><span class="p">[</span><span class="s1">&#39;TOUGH2_file&#39;</span><span class="p">]</span>

	<span class="c1">#Making sure the output file exists</span>
	<span class="n">t2_output_file</span><span class="o">=</span><span class="s2">&quot;../model/t2/</span><span class="si">%s</span><span class="s2">.out&quot;</span><span class="o">%</span><span class="n">t2_file_name</span>
	<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">t2_output_file</span><span class="p">):</span>
		<span class="k">pass</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="k">return</span> <span class="s2">&quot;Theres is not t2.out file on t2/</span><span class="si">%s</span><span class="s2">.out&quot;</span><span class="o">%</span><span class="n">t2_file_name</span>


	<span class="c1">#Extracting information about the layers</span>
	<span class="n">layers_info</span><span class="o">=</span><span class="n">geometry</span><span class="o">.</span><span class="n">vertical_layers</span><span class="p">(</span><span class="n">input_dictionary</span><span class="p">)</span>
	<span class="n">layer_tb</span><span class="o">=</span><span class="p">{</span><span class="n">layers_info</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">][</span><span class="n">n</span><span class="p">]:[</span><span class="n">layers_info</span><span class="p">[</span><span class="s1">&#39;bottom&#39;</span><span class="p">][</span><span class="n">n</span><span class="p">],</span><span class="n">layers_info</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">][</span><span class="n">n</span><span class="p">]]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">layers_info</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]))}</span>

	<span class="n">conn</span><span class="o">=</span><span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">db_path</span><span class="p">)</span>
	<span class="n">c</span><span class="o">=</span><span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>


	<span class="n">sources_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s2">&quot;SELECT well, source_nickname FROM t2wellsource&quot;</span><span class="p">,</span><span class="n">conn</span><span class="p">)</span>

	<span class="c1">#Extracting the sources from the TOUGH2 file</span>
	<span class="n">t2_ifile</span><span class="o">=</span><span class="s2">&quot;../model/t2/</span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">t2_file_name</span>
	<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">t2_ifile</span><span class="p">):</span>
		<span class="k">pass</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="k">return</span> <span class="s2">&quot;Theres is not t2 file&quot;</span>

	<span class="n">sources</span> <span class="o">=</span> <span class="p">[]</span>

	<span class="c1">#When splitting the SOURCES some of this versions of S{correlative}C could ocurr, the originall is simply SRC</span>
	<span class="n">options</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;SAC&#39;</span><span class="p">,</span><span class="s1">&#39;SBC&#39;</span><span class="p">,</span><span class="s1">&#39;SCC&#39;</span><span class="p">,</span><span class="s1">&#39;SDC&#39;</span><span class="p">,</span><span class="s1">&#39;SBB&#39;</span><span class="p">,</span><span class="s1">&#39;SDB&#39;</span><span class="p">,</span><span class="s1">&#39;SRC&#39;</span><span class="p">]</span>

	<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">t2_ifile</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">t2_ifile</span><span class="p">:</span>
		<span class="n">t2_i_array</span> <span class="o">=</span> <span class="n">t2_ifile</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
		<span class="n">print_io</span> <span class="o">=</span> <span class="kc">False</span>
		<span class="k">for</span> <span class="n">line_i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">t2_i_array</span><span class="p">):</span>
			<span class="k">if</span> <span class="s2">&quot;FLOWELL&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">():</span>
				<span class="n">print_io</span> <span class="o">=</span> <span class="kc">True</span>

			<span class="k">if</span> <span class="n">print_io</span><span class="p">:</span>
				<span class="k">if</span>  <span class="nb">any</span><span class="p">(</span><span class="n">src0</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span> <span class="k">for</span> <span class="n">src0</span> <span class="ow">in</span> <span class="n">options</span><span class="p">):</span>
					<span class="n">source</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()[</span><span class="mi">0</span><span class="p">:</span><span class="mi">10</span><span class="p">]</span>
					<span class="n">sources</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>

	<span class="n">cnt_s</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span><span class="mi">0</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">sources</span><span class="p">}</span>

	<span class="c1">#Initizalizing dictionary</span>
	<span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
	<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">init_values</span><span class="p">):</span>
		<span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;SOURCE&#39;</span><span class="p">:</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
		           <span class="s1">&#39;TIME&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
		           <span class="s1">&#39;ITER&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
		           <span class="s1">&#39;DATA&#39;</span><span class="p">:[]}</span>

	<span class="c1">#Extracting information from wellbore simulator from the TOUGH2 output file</span>
	<span class="n">output_headers</span><span class="o">=</span><span class="p">[]</span>
	<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">t2_output_file</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">t2_file</span><span class="p">:</span>
		<span class="n">t2_output_array</span> <span class="o">=</span> <span class="n">t2_file</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
		<span class="n">print_io</span> <span class="o">=</span> <span class="kc">False</span>
		<span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="n">not_include</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;=&#39;</span><span class="p">,</span><span class="s1">&#39;&amp;&#39;</span><span class="p">,</span><span class="s1">&#39;:&#39;</span><span class="p">,</span><span class="s1">&#39;*&#39;</span><span class="p">]</span>
		<span class="n">line_x</span> <span class="o">=</span> <span class="mf">1E50</span>
		<span class="n">iter_i</span> <span class="o">=</span> <span class="mi">0</span>

		<span class="k">for</span> <span class="n">line_i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">t2_output_array</span><span class="p">):</span>
			<span class="k">if</span> <span class="n">line_i</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
				<span class="c1">#Extracting the printout time</span>
				<span class="k">if</span> <span class="s2">&quot; WELLBORE SIMULATOR FLOWELL AT TIME&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">():</span>
					<span class="n">time_i</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;TIME:&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; SECONDS&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

				<span class="c1">#Extracting the source</span>
				<span class="k">if</span> <span class="s1">&#39; ------------------------------------------------&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">():</span>
					<span class="n">source</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;------------------------------------------------&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

				<span class="c1">#Extracting the iteration number</span>
				<span class="k">if</span> <span class="s1">&#39;-----------ITER =&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">():</span>
					<span class="n">iter_i</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; -----------ITER = &#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
					<span class="n">cnt</span> <span class="o">+=</span> <span class="mi">1</span>

				<span class="c1">#If this line occurs means in the next line the printout is going to happen</span>
				<span class="k">if</span> <span class="s1">&#39;    DEPTH          FLOW &#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">():</span>
					<span class="n">print_io</span> <span class="o">=</span> <span class="kc">True</span>
					<span class="n">line_x</span> <span class="o">=</span> <span class="n">line_i</span>

				<span class="c1">#If any of these lines occurs the printout ends</span>
				<span class="k">if</span> <span class="n">print_io</span><span class="p">:</span>
					<span class="k">if</span> <span class="s1">&#39; ------------------------------------------------&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">():</span>
						<span class="n">print_io</span> <span class="o">=</span> <span class="kc">False</span>
					<span class="k">elif</span> <span class="s1">&#39;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">():</span>
						<span class="n">print_io</span> <span class="o">=</span> <span class="kc">False</span>


				<span class="k">if</span> <span class="n">print_io</span> <span class="ow">and</span> <span class="n">line_i</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">line_x</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
					<span class="k">try</span><span class="p">:</span>
						<span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">s</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">not_include</span><span class="p">):</span>

							<span class="n">data_i</span> <span class="o">=</span> <span class="p">[]</span>
							<span class="n">add</span> <span class="o">=</span> <span class="kc">False</span>
							<span class="k">for</span> <span class="n">data_in</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">))):</span>
								<span class="c1">#if the source appears, then some especial treatment is needed</span>
								<span class="k">if</span> <span class="n">data_in</span> <span class="ow">in</span> <span class="n">sources</span><span class="p">:</span>
									<span class="n">cnt_s</span><span class="p">[</span><span class="n">data_in</span><span class="p">]</span> <span class="o">=</span> <span class="n">cnt_s</span><span class="p">[</span><span class="n">data_in</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span>
									<span class="n">source_i</span> <span class="o">=</span> <span class="n">data_in</span>

									<span class="c1">#extracts the MD value</span>
									<span class="k">if</span> <span class="n">cnt_s</span><span class="p">[</span><span class="n">data_in</span><span class="p">]</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
										<span class="n">MD</span> <span class="o">=</span> <span class="n">layer_tb</span><span class="p">[</span><span class="n">data_in</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span>
									<span class="k">elif</span> <span class="n">cnt_s</span><span class="p">[</span><span class="n">data_in</span><span class="p">]</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
										<span class="n">MD</span> <span class="o">=</span> <span class="n">layer_tb</span><span class="p">[</span><span class="n">data_in</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="mi">1</span><span class="p">]</span>
									
									<span class="n">well</span> <span class="o">=</span> <span class="n">sources_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">sources_data</span><span class="p">[</span><span class="s1">&#39;source_nickname&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">data_in</span><span class="p">[</span><span class="mi">5</span><span class="p">:</span><span class="mi">10</span><span class="p">]]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;well&#39;</span><span class="p">]</span>
									<span class="n">md</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">geometry</span><span class="o">.</span><span class="n">TVD_to_MD</span><span class="p">(</span><span class="n">well</span><span class="p">,</span><span class="n">MD</span><span class="p">))</span>
									<span class="n">data_i</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">md</span><span class="p">)</span>
								<span class="k">else</span><span class="p">:</span>
									<span class="n">data_i</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data_in</span><span class="p">))</span>
							
							<span class="c1">#On the second line of every feedzone the productivity index is printout, then it is necessary to fill with nan some spaces</span>
							<span class="k">if</span> <span class="n">cnt_s</span><span class="p">[</span><span class="n">source_i</span><span class="p">]</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
								<span class="n">data_i</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>

							<span class="c1">#Saves the values into the dictionary</span>
							<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_i</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
								<span class="n">data</span><span class="p">[</span><span class="n">cnt</span><span class="p">][</span><span class="s1">&#39;SOURCE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">source</span>
								<span class="n">data</span><span class="p">[</span><span class="n">cnt</span><span class="p">][</span><span class="s1">&#39;TIME&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">input_dictionary</span><span class="p">[</span><span class="s1">&#39;ref_date&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">time_i</span><span class="p">)))</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">_%H:%M:%S&quot;</span><span class="p">)</span>
								<span class="n">data</span><span class="p">[</span><span class="n">cnt</span><span class="p">][</span><span class="s1">&#39;ITER&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">iter_i</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> 
								<span class="n">data</span><span class="p">[</span><span class="n">cnt</span><span class="p">][</span><span class="s1">&#39;DATA&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data_i</span><span class="p">)</span>

					<span class="k">except</span> <span class="ne">UnboundLocalError</span><span class="p">:</span>
						<span class="k">pass</span>

	<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">orient</span> <span class="o">=</span> <span class="s1">&#39;index&#39;</span><span class="p">)</span>
	<span class="n">df</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="s1">&#39;../output/flowell.json&#39;</span><span class="p">,</span><span class="n">orient</span><span class="o">=</span><span class="s2">&quot;split&quot;</span><span class="p">,</span> <span class="n">indent</span> <span class="o">=</span> <span class="mi">4</span><span class="p">)</span></div>

<div class="viewcode-block" id="power_from_flowell"><a class="viewcode-back" href="../modules/output.html#output.power_from_flowell">[docs]</a><span class="k">def</span> <span class="nf">power_from_flowell</span><span class="p">(</span><span class="n">input_dictionary</span><span class="p">,</span> <span class="n">WHP</span><span class="p">,</span> <span class="n">exceptions</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;When all the well feedzones are declare as MASS and FLOWELL type in the TOUGH2 input file, this functions estimates the power generation based on the assumption of an isoenthalpic expansion from the feedzone to the wellhead for the MASS type</span>
<span class="sd">	and takes directly the steam saturation at the wellhead when it comes from FLOWELL.</span>

<span class="sd">	Parameters</span>
<span class="sd">	----------</span>
<span class="sd"> 	input_dictionary: dictionary</span>
<span class="sd">	  Dictionary contaning the path and name of database on keyword &#39;db_path&#39;</span>
<span class="sd"> 	WHP: dictionary</span>
<span class="sd"> 	  Using the structure: &#39;well&#39;:[WHP, ESC, &#39;unit&#39;, &#39;masstype&#39;]. masstype could be either MASS or FLOWELL</span>
<span class="sd"> 	exceptions: list</span>
<span class="sd"> 	  List of sources listed as FLOWELL than will be treated as MASS. It occurs when just one period from the wells are calibrate with FLOWELL. </span>

<span class="sd">	Returns</span>
<span class="sd">	-------</span>
<span class="sd">	File</span>
<span class="sd">	  units_power_flowell.csv: in output/</span>

<span class="sd">	Attention</span>
<span class="sd">	---------</span>
<span class="sd">	Functions src_csv() and eleme_CSV() should be ran before executing this function</span>
<span class="sd">	&quot;&quot;&quot;</span>

	<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;date_time&#39;</span><span class="p">,</span> <span class="s1">&#39;swh&#39;</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="s1">&#39;power&#39;</span><span class="p">,</span> <span class="s1">&#39;unit&#39;</span><span class="p">])</span>

	<span class="n">conn</span><span class="o">=</span><span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">input_dictionary</span><span class="p">[</span><span class="s1">&#39;db_path&#39;</span><span class="p">])</span>
	<span class="n">c</span><span class="o">=</span><span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

	<span class="n">well_sources</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM t2wellsource WHERE well LIKE &#39;TR-%&#39; OR well LIKE &#39;Mk%&#39; &quot;</span><span class="p">,</span><span class="n">conn</span><span class="p">)</span>

	<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">well_sources</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span> 
		<span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;well&#39;</span><span class="p">])</span> <span class="ow">in</span> <span class="p">[</span><span class="o">*</span><span class="n">WHP</span><span class="p">]:</span>
			<span class="n">evol_file</span> <span class="o">=</span> <span class="s1">&#39;../output/mh/txt/</span><span class="si">%s</span><span class="s1">_</span><span class="si">%s</span><span class="s1">_</span><span class="si">%s</span><span class="s1">_evol_mh.dat&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;well&#39;</span><span class="p">],</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;blockcorr&#39;</span><span class="p">],</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;source_nickname&#39;</span><span class="p">])</span>
			<span class="n">Pevol</span> <span class="o">=</span> <span class="s1">&#39;../output/PT/evol/</span><span class="si">%s</span><span class="s1">_PT_evol.dat&#39;</span><span class="o">%</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;well&#39;</span><span class="p">]</span>

			<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">evol_file</span><span class="p">):</span>
				<span class="k">if</span> <span class="n">WHP</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;well&#39;</span><span class="p">]][</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;FLOWELL&#39;</span><span class="p">:</span>
						
					<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">evol_file</span><span class="p">):</span>
						<span class="n">data_i</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">evol_file</span><span class="p">)</span>

						<span class="n">temp_i</span> <span class="o">=</span> <span class="n">data_i</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span> <span class="n">data_i</span><span class="p">[</span><span class="s1">&#39;TIME&#39;</span><span class="p">]</span> <span class="o">&gt;=</span><span class="mi">0</span> <span class="p">,</span> <span class="p">[</span><span class="s1">&#39;FWH&#39;</span><span class="p">,</span><span class="s1">&#39;SWH&#39;</span><span class="p">,</span> <span class="s1">&#39;TIME&#39;</span><span class="p">]]</span>

						<span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;source_nickname&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">exceptions</span><span class="p">:</span>

							<span class="k">if</span>  <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">Pevol</span><span class="p">):</span> 
								<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;******************************************************&#39;</span><span class="p">)</span>
								<span class="nb">print</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;well&#39;</span><span class="p">],</span> <span class="s1">&#39;FLOWELL, exception&#39;</span><span class="p">,</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;source_nickname&#39;</span><span class="p">])</span>

								<span class="n">data_i</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">Pevol</span><span class="p">)</span>

								<span class="n">temp_i</span> <span class="o">=</span> <span class="n">data_i</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span> <span class="p">(</span><span class="n">data_i</span><span class="p">[</span><span class="s1">&#39;ELEM&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span> <span class="p">[</span><span class="s1">&#39;blockcorr&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">data_i</span><span class="p">[</span><span class="s1">&#39;TIME&#39;</span><span class="p">]</span> <span class="o">&gt;=</span><span class="mi">0</span> <span class="p">),</span> <span class="p">[</span><span class="s1">&#39;PRES_VAP&#39;</span><span class="p">,</span><span class="s1">&#39;TIME&#39;</span><span class="p">]]</span>
								<span class="n">temp_i</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

								<span class="n">data_mh</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">evol_file</span><span class="p">)</span>

								<span class="n">times</span> <span class="o">=</span> <span class="n">data_mh</span><span class="p">[</span><span class="s1">&#39;TIME&#39;</span><span class="p">]</span>

								<span class="n">dates</span><span class="o">=</span><span class="p">[]</span>
								<span class="n">flow_rate</span> <span class="o">=</span> <span class="p">[]</span>
								<span class="n">swh</span> <span class="o">=</span> <span class="p">[]</span>
								<span class="n">power</span> <span class="o">=</span> <span class="p">[]</span>
								<span class="n">units</span> <span class="o">=</span> <span class="p">[]</span>

								<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">times</span><span class="p">)):</span>
									<span class="k">if</span> <span class="nb">float</span><span class="p">(</span><span class="n">times</span><span class="p">[</span><span class="n">n</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
										<span class="k">try</span><span class="p">:</span>
											<span class="n">flow_rate</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data_mh</span><span class="p">[</span><span class="s1">&#39;GEN&#39;</span><span class="p">][</span><span class="n">n</span><span class="p">])</span>
											<span class="n">dates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">input_dictionary</span><span class="p">[</span><span class="s1">&#39;ref_date&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">times</span><span class="p">[</span><span class="n">n</span><span class="p">])))</span>
											
											<span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;well&#39;</span><span class="p">])</span> <span class="ow">in</span> <span class="p">[</span><span class="o">*</span><span class="n">WHP</span><span class="p">]:</span>
												<span class="n">t</span> <span class="o">=</span> <span class="n">power_i</span><span class="p">(</span><span class="n">WHP</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;well&#39;</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mf">1E6</span><span class="p">,</span><span class="n">data_mh</span><span class="p">[</span><span class="s1">&#39;ENTH&#39;</span><span class="p">][</span><span class="n">n</span><span class="p">]</span><span class="o">/</span><span class="mf">1E3</span><span class="p">,</span><span class="n">data_mh</span><span class="p">[</span><span class="s1">&#39;GEN&#39;</span><span class="p">][</span><span class="n">n</span><span class="p">],</span><span class="n">WHP</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;well&#39;</span><span class="p">]][</span><span class="mi">1</span><span class="p">])</span>
												<span class="n">power</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
												<span class="n">swh</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
												<span class="n">units</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">WHP</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;well&#39;</span><span class="p">]][</span><span class="mi">2</span><span class="p">]</span> <span class="p">)</span>
											<span class="k">else</span><span class="p">:</span>
												<span class="n">power</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>

										<span class="k">except</span> <span class="p">(</span><span class="ne">OverflowError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">):</span>
											<span class="nb">print</span><span class="p">(</span><span class="n">times</span><span class="p">[</span><span class="n">n</span><span class="p">],</span><span class="s2">&quot;plus&quot;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">times</span><span class="p">[</span><span class="n">n</span><span class="p">]),</span><span class="s2">&quot;wont be plot&quot;</span><span class="p">)</span>

								<span class="n">input_row</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;date_time&#39;</span><span class="p">:</span> <span class="n">dates</span><span class="p">,</span>
								                 <span class="s1">&#39;m&#39;</span><span class="p">:</span> <span class="n">flow_rate</span><span class="p">,</span>
								               <span class="s1">&#39;swh&#39;</span><span class="p">:</span> <span class="n">swh</span><span class="p">,</span>
								               <span class="s1">&#39;power&#39;</span><span class="p">:</span><span class="n">power</span><span class="p">,</span>
								               <span class="s1">&#39;unit&#39;</span><span class="p">:</span><span class="n">units</span><span class="p">}</span>

								<span class="n">output</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">input_row</span><span class="p">)</span>
								<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">ignore_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
								<span class="nb">print</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;well&#39;</span><span class="p">],</span> <span class="s1">&#39;FLOWELL, exception&#39;</span><span class="p">,</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;source_nickname&#39;</span><span class="p">])</span>
						<span class="k">else</span><span class="p">:</span>

							<span class="nb">print</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;well&#39;</span><span class="p">],</span> <span class="s1">&#39;FLOWELL&#39;</span><span class="p">,</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;source_nickname&#39;</span><span class="p">])</span>

							<span class="n">temp_i</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

							<span class="n">times</span> <span class="o">=</span> <span class="n">temp_i</span><span class="p">[</span><span class="s1">&#39;TIME&#39;</span><span class="p">]</span>

							<span class="n">dates</span><span class="o">=</span><span class="p">[]</span>
							<span class="n">swh</span> <span class="o">=</span> <span class="p">[]</span>
							<span class="n">flow_rate</span> <span class="o">=</span> <span class="p">[]</span>
							<span class="n">power</span> <span class="o">=</span> <span class="p">[]</span>
							<span class="n">units</span> <span class="o">=</span> <span class="p">[]</span>

							<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">times</span><span class="p">)):</span>
								<span class="k">if</span> <span class="nb">float</span><span class="p">(</span><span class="n">times</span><span class="p">[</span><span class="n">n</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
									<span class="k">try</span><span class="p">:</span>
										<span class="n">flow_rate</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp_i</span><span class="p">[</span><span class="s1">&#39;FWH&#39;</span><span class="p">][</span><span class="n">n</span><span class="p">])</span>
										<span class="n">dates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">input_dictionary</span><span class="p">[</span><span class="s1">&#39;ref_date&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">times</span><span class="p">[</span><span class="n">n</span><span class="p">])))</span>
										<span class="n">swh</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp_i</span><span class="p">[</span><span class="s1">&#39;SWH&#39;</span><span class="p">][</span><span class="n">n</span><span class="p">])</span>
										<span class="n">power</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp_i</span><span class="p">[</span><span class="s1">&#39;SWH&#39;</span><span class="p">][</span><span class="n">n</span><span class="p">]</span><span class="o">*</span><span class="n">temp_i</span><span class="p">[</span><span class="s1">&#39;FWH&#39;</span><span class="p">][</span><span class="n">n</span><span class="p">]</span><span class="o">/</span><span class="n">WHP</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;well&#39;</span><span class="p">]][</span><span class="mi">1</span><span class="p">])</span>
										<span class="n">units</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">WHP</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;well&#39;</span><span class="p">]][</span><span class="mi">2</span><span class="p">])</span>

									<span class="k">except</span> <span class="p">(</span><span class="ne">OverflowError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">):</span>
										<span class="nb">print</span><span class="p">(</span><span class="n">times</span><span class="p">[</span><span class="n">n</span><span class="p">],</span><span class="s2">&quot;plus&quot;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">times</span><span class="p">[</span><span class="n">n</span><span class="p">]),</span><span class="s2">&quot;wont be plot&quot;</span><span class="p">)</span>

							<span class="n">input_row</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;date_time&#39;</span><span class="p">:</span> <span class="n">dates</span><span class="p">,</span>
							                 <span class="s1">&#39;swh&#39;</span><span class="p">:</span> <span class="n">swh</span><span class="p">,</span>
							                 <span class="s1">&#39;m&#39;</span><span class="p">:</span> <span class="n">flow_rate</span><span class="p">,</span>
							               <span class="s1">&#39;power&#39;</span><span class="p">:</span><span class="n">power</span><span class="p">,</span>
							               <span class="s1">&#39;unit&#39;</span><span class="p">:</span><span class="n">units</span><span class="p">}</span>

							<span class="n">output</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">input_row</span><span class="p">)</span>
							<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">ignore_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
							<span class="nb">print</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;well&#39;</span><span class="p">],</span> <span class="s1">&#39;FLOWELL&#39;</span><span class="p">,</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;source_nickname&#39;</span><span class="p">])</span>
				<span class="k">elif</span> <span class="n">WHP</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;well&#39;</span><span class="p">]][</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;MASS&#39;</span><span class="p">:</span>

					<span class="k">if</span>  <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">Pevol</span><span class="p">):</span>

						<span class="nb">print</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;well&#39;</span><span class="p">],</span> <span class="s1">&#39;MASS&#39;</span><span class="p">,</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;source_nickname&#39;</span><span class="p">])</span>

						<span class="n">data_i</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">Pevol</span><span class="p">)</span>

						<span class="n">temp_i</span> <span class="o">=</span> <span class="n">data_i</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span> <span class="p">(</span><span class="n">data_i</span><span class="p">[</span><span class="s1">&#39;ELEM&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span> <span class="p">[</span><span class="s1">&#39;blockcorr&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">data_i</span><span class="p">[</span><span class="s1">&#39;TIME&#39;</span><span class="p">]</span> <span class="o">&gt;=</span><span class="mi">0</span> <span class="p">),</span> <span class="p">[</span><span class="s1">&#39;PRES_VAP&#39;</span><span class="p">,</span><span class="s1">&#39;TIME&#39;</span><span class="p">]]</span>
						<span class="n">temp_i</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

						<span class="n">data_mh</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">evol_file</span><span class="p">)</span>

						<span class="n">times</span> <span class="o">=</span> <span class="n">data_mh</span><span class="p">[</span><span class="s1">&#39;TIME&#39;</span><span class="p">]</span>

						<span class="n">dates</span><span class="o">=</span><span class="p">[]</span>
						<span class="n">flow_rate</span> <span class="o">=</span> <span class="p">[]</span>
						<span class="n">swh</span> <span class="o">=</span> <span class="p">[]</span>
						<span class="n">power</span> <span class="o">=</span> <span class="p">[]</span>
						<span class="n">units</span> <span class="o">=</span> <span class="p">[]</span>

						<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">times</span><span class="p">)):</span>
							<span class="k">if</span> <span class="nb">float</span><span class="p">(</span><span class="n">times</span><span class="p">[</span><span class="n">n</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
								<span class="k">try</span><span class="p">:</span>
									<span class="n">flow_rate</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data_mh</span><span class="p">[</span><span class="s1">&#39;GEN&#39;</span><span class="p">][</span><span class="n">n</span><span class="p">])</span>
									<span class="n">dates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">input_dictionary</span><span class="p">[</span><span class="s1">&#39;ref_date&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">times</span><span class="p">[</span><span class="n">n</span><span class="p">])))</span>
									
									<span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;well&#39;</span><span class="p">])</span> <span class="ow">in</span> <span class="p">[</span><span class="o">*</span><span class="n">WHP</span><span class="p">]:</span>
										<span class="n">t</span> <span class="o">=</span> <span class="n">power_i</span><span class="p">(</span><span class="n">WHP</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;well&#39;</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mf">1E6</span><span class="p">,</span><span class="n">data_mh</span><span class="p">[</span><span class="s1">&#39;ENTH&#39;</span><span class="p">][</span><span class="n">n</span><span class="p">]</span><span class="o">/</span><span class="mf">1E3</span><span class="p">,</span><span class="n">data_mh</span><span class="p">[</span><span class="s1">&#39;GEN&#39;</span><span class="p">][</span><span class="n">n</span><span class="p">],</span><span class="n">WHP</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;well&#39;</span><span class="p">]][</span><span class="mi">1</span><span class="p">])</span>
										<span class="n">power</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
										<span class="n">swh</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
										<span class="n">units</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">WHP</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;well&#39;</span><span class="p">]][</span><span class="mi">2</span><span class="p">])</span>
									<span class="k">else</span><span class="p">:</span>
										<span class="n">power</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>

								<span class="k">except</span> <span class="p">(</span><span class="ne">OverflowError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">):</span>
									<span class="nb">print</span><span class="p">(</span><span class="n">times</span><span class="p">[</span><span class="n">n</span><span class="p">],</span><span class="s2">&quot;plus&quot;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">times</span><span class="p">[</span><span class="n">n</span><span class="p">]),</span><span class="s2">&quot;wont be plot&quot;</span><span class="p">)</span>

						<span class="n">input_row</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;date_time&#39;</span><span class="p">:</span> <span class="n">dates</span><span class="p">,</span>
						                 <span class="s1">&#39;m&#39;</span><span class="p">:</span> <span class="n">flow_rate</span><span class="p">,</span>
						               <span class="s1">&#39;swh&#39;</span><span class="p">:</span> <span class="n">swh</span><span class="p">,</span>
						               <span class="s1">&#39;power&#39;</span><span class="p">:</span><span class="n">power</span><span class="p">}</span>

						<span class="n">output</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">input_row</span><span class="p">)</span>

						<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">ignore_index</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

						<span class="nb">print</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;well&#39;</span><span class="p">],</span> <span class="s1">&#39;MASS&#39;</span><span class="p">,</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;source_nickname&#39;</span><span class="p">])</span>

	<span class="n">data_out</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;date_time&#39;</span><span class="p">,</span><span class="s1">&#39;unit&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
	<span class="n">data_out</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;../output/units_power_flowell.csv&#39;</span><span class="p">)</span></div>

</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2022, Erick Jimenez

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>